var surveyJSON = '{"title": "CaDC Open Water Rate Specification Tool",' +
'"utilities": [' +
'"Pomona  City of",'+
'"Merced  City of",'+
'"Menlo Park  City of",'+
'"Coachella Valley Water District",'+
'"Vallecitos Water District",'+
'"Alhambra  City of",'+
'"Poway  City of",'+
'"American Canyon, City of",'+
'"San Bernardino  City of",'+
'"Ontario  City of",'+
'"Rainbow Municipal Water District",'+
'"Humboldt Bay Municipal Water District",'+
'"Fountain Valley  City of",'+
'"Hollister  City of",'+
'"Alameda County Water District",'+
'"Suburban Water Systems San Jose Hills",'+
'"Valley County Water District",'+
'"San Gabriel Valley Fontana Water Company",'+
'"Los Angeles Department of Water and Power",'+
'"San Bruno  City of",'+
'"Los Banos, City of",'+
'"Stockton  City of",'+
'"Golden State Water Company Placentia",'+
'"Lomita  City of",'+
'"Big Bear City Community Services District",'+
'"Santa Ana  City of",'+
'"Pasadena  City of",'+
'"San Buenaventura  City of",'+
'"Sacramento  City of",'+
'"Inglewood  City of",'+
'"Greenfield, City of",'+
'"Hanford  City of",'+
'"North Tahoe Public Utility District",'+
'"Linda County Water District",'+
'"Indian Wells Valley Water District",'+
'"Great Oaks Water Company Incorporated",'+
'"Yuba City  City of",'+
'"Golden State Water Company Artesia",'+
'"Burlingame  City of",'+
'"Carmichael Water District",'+
'"San Lorenzo Valley Water District",'+
'"Vaughn Water Company",'+
'"West Valley Water District",'+
'"Nevada Irrigation District",'+
'"Ramona Municipal Water District",'+
'"Carlsbad Municipal Water District",'+
'"Imperial, City of",'+
'"Crescenta Valley Water District",'+
'"Santa Maria  City of",'+
'"Tuolumne Utilities District",'+
'"Orange  City of",'+
'"Atascadero Mutual Water Company",'+
'"Eastern Municipal Water District",'+
'"Buena Park  City of",'+
'"Calaveras County Water District",'+
'"Montecito Water District",'+
'"Discovery Bay Community Services District",'+
'"Fullerton  City of",'+
'"San Fernando  City of",'+
'"Rowland Water District",'+
'"Corona  City of",'+
'"Modesto, City of",'+
'"Lodi  City of Public Works Department",'+
'"Covina  City of",'+
'"Contra Costa Water District",'+
'"Lakeside Water District",'+
'"Oakdale  City of",'+
'"California-American Water Company Monterey District",'+
'"California-American Water Company Los Angeles District",'+
'"Paradise Irrigation District",'+
'"East Valley Water District",'+
'"Golden State Water Company Bell-Bell Gardens",'+
'"Fair Oaks Water District",'+
'"Reedley  City of",'+
'"Fallbrook Public Utility District",'+
'"Gilroy  City of",'+
'"Torrance  City of",'+
'"Nipomo Community Services District",'+
'"California Water Service Company East Los Angeles",'+
'"Rubidoux Community Service District",'+
'"Newhall County Water District",'+
'"Lake Hemet Municipal Water District",'+
'"Lake Arrowhead Community Services District",'+
'"El Segundo  City of",'+
'"Ripon  City of",'+
'"Golden State Water Company Orcutt",'+
'"Sunnyvale  City of",'+
'"Paramount  City of",'+
'"California Water Service Company Willows",'+
'"Rincon Del Diablo Municipal Water District",'+
'"California Water Service Company Selma",'+
'"Coastside County Water District",'+
'"Garden Grove  City of",'+
'"Rosamond Community Service District",'+
'"Grover Beach  City of",'+
'"Diablo Water District",'+
'"Chino Hills  City of",'+
'"California-American Water Ventura District",'+
'"Coalinga City of",'+
'"Bella Vista Water District",'+
'"Benicia  City of",'+
'"California Water Service Company Stockton",'+
'"Walnut Valley Water District",'+
'"Escondido  City of",'+
'"San Dieguito Water District",'+
'"Cerritos  City of",'+
'"Golden State Water Company West Orange",'+
'"Vallejo  City of",'+
'"Valley Center Municipal Water District",'+
'"Atwater  City of",'+
'"Banning  City of",'+
'"Sunnyslope County Water District",'+
'"California Water Service Company Marysville",'+
'"Healdsburg  City of",'+
'"California Water Service Company Westlake",'+
'"Ventura County Waterworks District No. 8",'+
'"Castaic Lake Water Agency Santa Clarita Water Division",'+
'"Yorba Linda Water District",'+
'"City of Big Bear Lake, Dept of Water & Power",'+
'"Valley of the Moon Water District",'+
'"Perris, City of",'+
'"Beaumont-Cherry Valley Water District",'+
'"Palmdale Water District",'+
'"Thousand Oaks  City of",'+
'"Seal Beach  City of",'+
'"Fairfield  City of",'+
'"Azusa  City of",'+
'"Hemet  City of",'+
'"San Jacinto  City of",'+
'"Riverside Highland Water Company",'+
'"Oildale Mutual Water Company",'+
'"Olivehurst Public Utility District",'+
'"Pittsburg  City of",'+
'"Citrus Heights Water District",'+
'"Orchard Dale Water District",'+
'"Golden State Water Company Culver City",'+
'"Watsonville  City of",'+
'"Millbrae  City of",'+
'"California City  City of",'+
'"California Water Service Company South San Francisco",'+
'"Compton  City of",'+
'"Western Municipal Water District of Riverside",'+
'"Lamont Public Utility District",'+
'"Shasta Lake  City of",'+
'"Madera  City of",'+
'"Golden State Water Company San Dimas",'+
'"Moulton Niguel Water District",'+
'"Vernon  City of",'+
'"Alco Water Service",'+
'"California Water Service Company Palos Verdes",'+
'"Rio Linda - Elverta Community Water District",'+
'"Pinedale County Water District",'+
'"Sanger  City of",'+
'"Mesa Water District",'+
'"Rohnert Park  City of",'+
'"Otay Water District",'+
'"Santa Barbara  City of",'+
'"Scotts Valley Water District",'+
'"Lompoc  City of",'+
'"Santa Rosa  City of",'+
'"East Orange County Water District",'+
'"Lakewood  City of",'+
'"Golden State Water Company Claremont",'+
'"Anaheim  City of",'+
'"Vacaville  City of",'+
'"San Juan Water District",'+
'"Riverside  City of",'+
'"Ventura County Waterworks District No 1",'+
'"Joshua Basin Water District",'+
'"Calexico  City of",'+
'"Placer County Water Agency",'+
'"Rancho California Water District",'+
'"Antioch  City of",'+
'"Rialto  City of",'+
'"Camarillo  City of",'+
'"Golden State Water Company S Arcadia",'+
'"Monterey Park  City of",'+
'"Rio Vista, city of",'+
'"Roseville  City of",'+
'"California Water Service Company Bakersfield",'+
'"California Water Service Company Dixon, City of",'+
'"Eureka  City of",'+
'"Yreka, City of",'+
'"Triunfo Sanitation District / Oak Park Water Service",'+
'"Dinuba  City of",'+
'"Santa Cruz  City of",'+
'"Red Bluff  City of",'+
'"Crescent City  City of",'+
'"Hawthorne  City of",'+
'"Valencia Water Company",'+
'"South Pasadena  City of",'+
'"California Water Service Company Dominguez",'+
'"Fresno  City of",'+
'"Sonoma  City of",'+
'"Redwood City  City of",'+
'"Whittier  City of",'+
'"Adelanto City of",'+
'"Las Virgenes Municipal Water District",'+
'"Martinez  City of",'+
'"Santa Margarita Water District",'+
'"San Bernardino County Service Area 70J",'+
'"Camrosa Water District",'+
'"Glendora  City of",'+
'"Davis  City of",'+
'"South Gate  City of",'+
'"North Coast County Water District",'+
'"Del Oro Water Company",'+
'"Golden State Water Company S San Gabriel",'+
'"North Marin Water District",'+
'"Golden State Water Company Barstow",'+
'"Chino  City of",'+
'"Crestline Village Water District",'+
'"Paso Robles  City of",'+
'"Olivenhain Municipal Water District",'+
'"Valley Water Company",'+
'"Mountain View  City of",'+
'"San Jose Water Company",'+
'"Dublin San Ramon Services District",'+
'"Pico Water District",'+
'"Ceres  City of",'+
'"Fillmore  City of",'+
'"South Tahoe Public Utilities District",'+
'"Suisun-Solano Water Authority",'+
'"Huntington Park  City of",'+
'"Irvine Ranch Water District",'+
'"California Water Service Company Livermore",'+
'"California Water Service Company Los Altos/Suburban",'+
'"Porterville  City of",'+
'"Monte Vista Water District",'+
'"Downey  City of",'+
'"San Clemente  City of",'+
'"Tehachapi, City of",'+
'"Soquel Creek Water District",'+
'"Hillsborough  Town of",'+
'"Turlock  City of",'+
'"Santa Clara  City of",'+
'"Carpinteria Valley Water District",'+
'"South Feather Water and Power Agency",'+
'"Tahoe City Public Utilities District",'+
'"Cucamonga Valley Water District",'+
'"Folsom  City of",'+
'"La Verne  City of",'+
'"Tracy  City of",'+
'"California Water Service Company Hermosa/Redondo",'+
'"Sierra Madre  City of",'+
'"California-American Water Company San Diego District",'+
'"Blythe  City of",'+
'"West Kern Water District",'+
'"Oxnard  City of",'+
'"Long Beach  City of",'+
'"Sacramento Suburban Water District",'+
'"Montebello Land and Water Company",'+
'"Pismo Beach  City of",'+
'"California Water Service Company Mid Peninsula",'+
'"Arcata  City of",'+
'"Mid-Peninsula Water District",'+
'"Beverly Hills  City of",'+
'"Corcoran, City of",'+
'"Indio  City of",'+
'"Riverbank  City of",'+
'"Elsinore Valley Municipal Water District",'+
'"San Luis Obispo  City of",'+
'"Sacramento County Water Agency",'+
'"Milpitas  City of",'+
'"Fruitridge Vista Water Company",'+
'"Arroyo Grande  City of",'+
'"Livermore  City of Division of Water Resources",'+
'"San Diego  City of",'+
'"Georgetown Divide Public Utilities District",'+
'"Burbank  City of",'+
'"Exeter  City of",'+
'"San Bernardino County Service Area 64",'+
'"Casitas Municipal Water District",'+
'"Coachella  City of",'+
'"Brentwood  City of",'+
'"Upland  City of",'+
'"Huntington Beach  City of",'+
'"California Water Service Company Visalia",'+
'"Windsor, Town of",'+
'"Clovis  City of",'+
'"Palo Alto  City of",'+
'"Manteca  City of",'+
'"Santa Fe Springs  City of",'+
'"Phelan Pinon Hills Community Services District",'+
'"California-American Water Company Sacramento District",'+
'"Truckee-Donner Public Utilities District",'+
'"Bakman Water Company",'+
'"Shafter  City of",'+
'"Hi-Desert Water District",'+
'"Golden State Water Company Cowan Heights",'+
'"San Jose  City of",'+
'"East Palo Alto, City of",'+
'"Lincoln  City of",'+
'"El Centro  City of",'+
'"Sweetwater Springs Water District",'+
'"El Dorado Irrigation District",'+
'"Golden State Water Company Southwest",'+
'"Sunny Slope Water Company",'+
'"Mountain House Community Services District",'+
'"Galt  City of",'+
'"Pico Rivera  City of",'+
'"Delano  City of",'+
'"Groveland Community Services District",'+
'"California Water Service Company Salinas District",'+
'"San Juan Capistrano  City of",'+
'"Petaluma  City of",'+
'"Redlands  City of",'+
'"El Toro Water District",'+
'"Lincoln Avenue Water Company",'+
'"Marin Municipal Water District",'+
'"Morgan Hill  City of",'+
'"Laguna Beach County Water District",'+
'"California Water Service Company Kern River Valley",'+
'"Yucaipa Valley Water District",'+
'"Los Angeles County Public Works Waterworks District 29",'+
'"Livingston  City of",'+
'"Estero Municipal Improvement District",'+
'"McKinleyville Community Service District",'+
'"Jurupa Community Service District",'+
'"Victorville Water District",'+
'"Lee Lake Water District",'+
'"Rubio Canyon Land and Water Association",'+
'"Fortuna  City of",'+
'"California Water Service Company Bear Gulch",'+
'"Kingsburg, City of",'+
'"Daly City  City of",'+
'"City of Newman Water Department",'+
'"Lathrop, City of",'+
'"Napa  City of",'+
'"Brea  City of",'+
'"Mammoth Community Water District",'+
'"Golden State Water Company Norwalk",'+
'"Golden State Water Company Florence Graham",'+
'"Santa Paula  City of",'+
'"Manhattan Beach  City of",'+
'"Morro Bay  City of",'+
'"Patterson  City of",'+
'"Tulare, City of",'+
'"Bakersfield  City of",'+
'"Golden State Water Company Simi Valley",'+
'"Suburban Water Systems Whittier/La Mirada",'+
'"California Water Service Company Chico District",'+
'"Marina Coast Water District",'+
'"La Palma  City of",'+
'"Westborough Water District",'+
'"South Coast Water District",'+
'"Park Water Company",'+
'"Padre Dam Municipal Water District",'+
'"Glendale  City of",'+
'"Helix Water District",'+
'"Norwalk City of",'+
'"Vista Irrigation District",'+
'"Santa Fe Irrigation District",'+
'"Los Angeles County Public Works Waterworks District 40",'+
'"Golden State Water Company Bay Point",'+
'"West Sacramento  City of",'+
'"Hayward  City of",'+
'"Sweetwater Authority",'+
'"Lemoore  City of",'+
'"Anderson, City of",'+
'"Brawley  City of",'+
'"La Habra  City of Public Works",'+
'"East Niles Community Service District",'+
'"Santa Monica  City of",'+
'"Newport Beach  City of",'+
'"Susanville  City of",'+
'"Hesperia Water District City of",'+
'"Trabuco Canyon Water District",'+
'"Elk Grove Water Service",'+
'"Goleta Water District",'+
'"California Water Service Company King City",'+
'"Cambria Community Services District",'+
'"Woodland  City of",'+
'"Kerman, City of",'+
'"Westminster  City of",'+
'"Quartz Hill Water District",'+
'"Loma Linda  City of *",'+
'"California Water Service Company Oroville",'+
'"Apple Valley Ranchos Water Company",'+
'"Soledad, City of",'+
'"Golden State Water Company Cordova",'+
'"Redding  City of",'+
'"Bellflower-Somerset Mutual Water Company",'+
'"East Bay Municipal Utilities District",'+
'"San Francisco Public Utilities Commission",'+
'"San Gabriel County Water District",'+
'"Oceanside  City of",'+
'"Orange Vale Water Company",'+
'"San Gabriel Valley Water Company",'+
'"Colton, City of",'+
'"Mission Springs Water District",'+
'"Lynwood  City of",'+
'"Winton Water & Sanitary District",'+
'"Wasco  City of",'+
'"Ukiah  City of",'+
'"Monrovia  City of",'+
'"Tustin  City of",'+
'"Myoma Dunes Mutual Water Company",'+
'"California Water Service Company Redwood Valley",'+
'"Port Hueneme  City of",'+
'"Arcadia  City of",'+
'"Humboldt Community Service District",'+
'"Pleasanton  City of",'+
'"Norco  City of",'+
'"El Monte  City of",'+
'"California Water Service Company Antelope Valley",'+
'"Arvin Community Services District",'+
'"Twentynine Palms Water District",'+
'"Desert Water Agency",'+
'"Amador Water Agency"],'+
'"questions": ["Enter the Name of the Utility:", "Enter the Bill Frequency:",'+
'"Enter the Effective Date of this Rate Structure:", "Select the Customer Classes Used by the Utility:",'+
' "Does this Customer Class contain a Service Charge?", "Does the Service Charge depend on the following:",'+
'"Does this Customer Class contain a Commodity Charge?", "What type of Commodity Charge does this Customer Class Contain?",'+
'"Does this Uniform Commodity Charge Depend On Anything?", "How Many Tiers are There?",' +
' "Do the Tier Levels Depend On Anything?", "Select the parameters to include:",'+
' "Do the Tier Prices Depend On Anything?"],'+
'"billFrequency": ["Monthly", "BiMonthly", "Quarterly", "Annually", "Other"],'+
'"rateStructures":['+
'"Residential Single", "Residential Multi",'+
'"Irrigation", "Commercial",'+
'"Industrial", "Institutional",'+
'"Fire Service", "Non-Potable",'+
'"Non-Residential", "Unmetered",'+
'"Reclaimed", "Governmental",'+
'"Interruptible", "Docks Shipping",'+
'"Potable", "Recycled",'+
'"Building Contractor", "Residential Construction",'+
'"Other"],'+
'"commodityDependsOn": ["Meter Size", "Meter Type", "Season", "Temperature Zone", "Elevation Zone", "Pressure Zone", "Lot Size Group", "Month", "Area"],'+
'"meterSizes": ["5/8","3/4", "1", "1 1/2", "2", "3", "4", "6", "8", "10", "12", "14", "16", "18"],'+
'"meterTypes": ["Disc", "Compound", "Turbo", "Magnetic Meter", "Propeller", "Omni F2", "Displacement"],'+
'"season": ["Summer", "Winter"],'+
'"temperatureZone": ["Low", "Medium", "High"], '+
'"elevationZone":["1", "2", "3", "4", "5", "6"],'+
'"pressureZone":["1", "2", "3", "4", "5", "6"],'+
'"lotSizeGroup":["1", "2", "3", "4", "5"],'+
'"month": ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],'+
'"area": ["Inside City", "Outside City"]}'
var survey = JSON.parse(surveyJSON)

                var form = document.getElementById("survey");
                var title = document.getElementById("Header");
                var subtitle = document.getElementById("lilHeader");
                var currentIndex = 0;
                
                var Question;
                var Answer;
                var text;
                var OWRSformat;
                
                var UtilityName = "";
                var BillFrequency = "";
                var EffectiveDate = "";
                var SelectedRateStructures = [];
                var ServiceSame = [];
                
                var serviceParameters = [];
                var serviceChargeCategories = [];
                var serviceCharges = [];
                var isServiceCharge = [];
                var isServiceDepends = [];
                var isServiceSame = [];
                var serviceSameStructure = [];
                var ParametersToUse = [];
                
                var uniformParameters = [];
                var commodityStructure = [];
                var numOfTiers = [];
                var tierStartsParameters = [];
                var tierStarts = [];
                var isTierStartsDepends = [];
                var tierStartsValues = [];
                var tierStartsCategories = [];
                var tierPricesParameters = [];
                var tierPrices = [];
                var isTierPricesDepends = [];
                var tierLevels = [];
                var uniformPrices = [];
                var isCommodityCharge = [];
                var isUniformDependsOn = [];
                var commodityChargeCategories = [];
                var commodityCharges = [];
                var tierStartsDependsOn = [];
                var tierPricesDependsOn = [];
                var isCapacityCharge = false;
                var capacityMeterSizes;
                var capacityCharges;
                
                var gpcd = [];
                var landscape_factor = [];
                var indoor = [];
                var outdoor = [];
                var budget = [];
                
                var uniformDependsOn = [];
                var commodityMeterSize = [];
                var month = [];
                var season = [];
                var elevationZone = [];
                var pressureZone = [];
                var temperatureZone = [];
                var lotSizeGroup = [];
                var meterType = [];
                var area = [];
                
                
                //Fills All Html elements for first page
                function MainPage()
                {
                    //Set The Title and Clear Form If Present
                    title.innerHTML = survey.title;
                    subtitle.innerHTML = "";
                    clear(form);
                    
                    QuestionTxt(survey.questions[0], 1, form);
                
                    //Create Utility Name DropDown List
                    Answer = document.createElement("select");
                
                    for(var i = 0; i < survey.utilities.length; ++i)
                    {
                        Answer.appendChild(new Option(survey.utilities[i], survey.utilities[i]));
                    }
                    Answer.id = "utilityName";
                    Answer.classList.add("form-control");
                    Answer.classList.add("select");
                    form.appendChild(Answer);
                
                    QuestionTxt(survey.questions[1], 2, form);
                    
                    //Create Bill Frequency Drop Down
                    Answer = document.createElement("select");
                
                    for(var i = 0; i < survey.billFrequency.length; ++i)
                    {
                        Answer.appendChild(new Option(survey.billFrequency[i], survey.billFrequency[i]));
                    }
                    Answer.id = "billFrequency";
                    Answer.classList.add("form-control");
                    form.appendChild(Answer);
                    
                    QuestionTxt(survey.questions[2], 3, form);
                    
                    //Create Effective Date Date Input
                    Answer = document.createElement("input");
                    Answer.setAttribute("type", "date");
                    Answer.classList.add("form-control");
                    Answer.id = "effectiveDate";
                    form.appendChild(Answer);
                    
                    QuestionTxt(survey.questions[3], 4, form);
                    
                    //Creates Checkboxes for all the Rate Structures
                    for(var i = 0; i < survey.rateStructures.length; ++i)
                    {
                        DIV = document.createElement("div");
                        DIV.classList.add("checkbox");
                        form.appendChild(DIV);
                        
                        Answer = document.createElement("label");
                        Answer.setAttribute("for", "custClass" + i); 
                        Answer.innerHTML = '<input type = "checkbox" id = "custClass'+ i +'" value = "' + survey.rateStructures[i] +'"/> ' + survey.rateStructures[i] + '';
                        DIV.appendChild(Answer); 
                    }
                    
                    //Buttons To Call answers and go to next rate stucture
                    var ButtonDiv = document.createElement("div");
                    ButtonDiv.style.marginTop = "15px";
                    form.appendChild(ButtonDiv);
                    
                    var Button = document.createElement("span");
                    Button.id = "nextButton";
                    Button.innerHTML = '<button type = "button" onclick = "GetMainPageAnswers()" class = "btn">Next</button>';
                    ButtonDiv.appendChild(Button);
                    
                    //Checks if Data is Present and Populates inputs if so
                    if(UtilityName != "")
                    {
                        document.getElementById("utilityName").value = UtilityName;
                        document.getElementById("billFrequency").value = BillFrequency;
                        document.getElementById("effectiveDate").value = EffectiveDate;
                        
                        for(var i = 0; i < 17; ++i)
                        {
                            var temp = document.getElementById("custClass" + i);
                            
                            check = false;
                            for(var j = 0; j < SelectedRateStructures.length; ++j)
                            {
                                var test = survey.rateStructures[i];
                                
                                if( test == SelectedRateStructures[j])
                                {
                                    var check = true;
                                }
                            }
                            
                            if(check)
                            {
                                temp.checked = true;
                            }
                        }
                    }
                    
                    //Styles DropDown Lists
                    $(document).ready(function() {
                    $(".select").select2();
                    });
                    
                }
                
                //Gets Data from first page and calls RateStructure Function
                function GetMainPageAnswers()
                {
                    //Clears array and gets data from form elements
                    SelectedRateStructures = [];
                    UtilityName = document.getElementById("utilityName").value;
                    BillFrequency = document.getElementById("billFrequency").value;
                    EffectiveDate = document.getElementById("effectiveDate").value;
                    
                    //Error checking for Date
                    var date = true;
                    if(EffectiveDate == "")
                    { 
                        alert("Must select an Effective Date for the Rate Structure");
                        date = false;
                    }
                    
                    //Error Checking for Rate Structures
                    var noneChecked = true;
                    for(var numOfCheckBoxes = 0; numOfCheckBoxes < survey.rateStructures.length ; ++numOfCheckBoxes)
                    {
                        var temp = document.getElementById("custClass" + numOfCheckBoxes);
                        
                        
                        if(temp.checked == true)
                        { 
                            SelectedRateStructures.push(survey.rateStructures[numOfCheckBoxes]);
                            noneChecked = false;
                        }
                    }
                    if(noneChecked)
                    { alert("Please Select A Customer Class"); }
                    
                    //Call Next Page
                    if(!noneChecked && date)
                    ChargePage();
                }
                
                function ChargePage()
                {
                    title.innerHTML = UtilityName;
                    subtitle.innerHTML = "Capacity Charges";
                    clear(form);
                    
                    var capacityDiv = document.createElement("div");
                    capacityDiv.id = "Capacity";
                    form.appendChild(capacityDiv);
                    
                    var questionDiv = document.createElement("div");
                    questionDiv.id = "questionDiv";
                    capacityDiv.appendChild(questionDiv);
                    
                    var meterDiv = document.createElement("div");
                    meterDiv.id = "meterDiv";
                    capacityDiv.appendChild(meterDiv);
                    
                    var fieldDiv = document.createElement("div");
                    fieldDiv.id = "fieldDiv";
                    capacityDiv.appendChild(fieldDiv);
                    
                    QuestionTxt("Is there a Capacity Charge(s) for this Utility", 13, questionDiv);
                    
                    Answer = document.createElement("span");
                    
                    if(isCapacityCharge)
                    {
                        Answer.innerHTML = '<label for = "YesCapacityCharge" class ="radio-inline"><input type = "radio" id = "YesCapacityCharge" name = "isCapacityCharge" onclick = "capacityCharge()" value = "Yes"   checked = "true"/>Yes</label>'+
                        '<label for = "NoCapacityCharge" class ="radio-inline"><input type = "radio" id = "NoCapacityCharge" name = "isCapacityCharge" onclick = "capacityCharge()" value = "No"/>No</label>';
                        questionDiv.appendChild(Answer);
                        capacityCharge();
                    }
                    else
                    {
                        Answer.innerHTML = '<label for = "YesCapacityCharge" class ="radio-inline"><input type = "radio" id = "YesCapacityCharge" name = "isCapacityCharge" onclick = "capacityCharge()" value = "Yes" />Yes</label>'+
                        '<label for = "NoCapacityCharge" class ="radio-inline"><input type = "radio" id = "NoCapacityCharge" name = "isCapacityCharge" onclick = "capacityCharge()" value = "No"  checked = "true"/>No</label>';
                        questionDiv.appendChild(Answer);
                    }
                    
                    var ButtonDiv = document.createElement("div");
                    ButtonDiv.style.marginTop = "15px";
                    form.appendChild(ButtonDiv);
                    
                    
                    var Button = document.createElement("span");
                    Button.innerHTML = '<button type = "button" style = "margin-right: 10px" onclick = "MainPage()" class ="btn">Previous</button>' + 
                    '<button type = "button" onclick = "ChargePageAnswers()" class = "btn">Next</button>';
                    ButtonDiv.appendChild(Button);
                }
                
                function capacityCharge()
                {
                    var Radio = document.getElementById("YesCapacityCharge");
                    isCapacityCharge = Radio.checked;
                    
                    if(isCapacityCharge)
                    {
                        var meterDiv = document.getElementById("meterDiv");
                        if(meterDiv.childNodes.length > 0)
                        {
                            clear(meterDiv)
                        }
                        
                        QuestionTxt("Select the Meter Sizes that have a Capacity Charge", 100, meterDiv);
                        
                        for(var i = 0; i < survey.meterSizes.length; ++i)
                        {
                            var divider = document.createElement("div");
                            divider.classList.add("checkbox");
                            var checkboxID = "MeterSize" + i;
                            divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "CapacityValues" onclick = "getCapacityValues()" value ="' + survey.meterSizes[i]+ '"/>'+
                            '' + survey.meterSizes[i] + '"</label>';
                            meterDiv.appendChild(divider);
                        }
                        
                        if(capacityMeterSizes != null)
                        {
                            for(var i = 0; i < survey.meterSizes.length; ++i)
                            {
                                var checkCheckBox = document.getElementById("MeterSize" + i);
                                for(var j = 0; j < capacityMeterSizes.length; ++j)
                                {
                                    if(commodityMeterSize[j] == checkCheckBox.value + "<QUOTE>")
                                    {   
                                        checkCheckBox.checked = true;
                                    }
                                }
                            }
                            
                            getCapacityValues();
                        }
                    }
                    else
                    {
                        capacityMeterSizes = null;
                        ChargePage();
                    }
                }
                
                function getCapacityValues()
                {
                    capacityMeterSizes = [];
                    
                    for(var i = 0; i < survey.meterSizes.length; ++i)
                    {
                        var temp = document.getElementById("MeterSize" + i);
                        if(temp.checked)
                        {
                            capacityMeterSizes.push(temp.value + "<QUOTE>");
                        }
                    }
                    
                    createCapacityFields();
                }
                
                function createCapacityFields()
                {
                    var fieldDiv = document.getElementById("fieldDiv");
                    if(fieldDiv.childNodes.length > 0)
                        clear(fieldDiv);
                    
                    QuestionTxt("Enter The Capacity Charges Below:", 45, fieldDiv)
                    
                    for(var i = 0; i < capacityMeterSizes.length; ++i)
                        {
                            divider = document.createElement("div");
                            divider.classList.add("form-group");
                            fieldDiv.appendChild(divider);
                                    
                            Answer = document.createElement("label");
                            Answer.setAttribute("for", "capacityCharge" + i);
                            Answer.appendChild(document.createTextNode(capacityMeterSizes[i].split("<QUOTE>").join('"')));
                            divider.appendChild(Answer);
                                
                            inputGroup = document.createElement("div");
                            inputGroup.classList.add("input-group");
                            divider.appendChild(inputGroup);
                                    
                            Answer = document.createElement("span");
                            Answer.classList.add("input-group-addon");
                            Answer.innerHTML = '<i class="glyphicon glyphicon-usd"></i>';
                            inputGroup.appendChild(Answer);
                                
                            Answer = document.createElement("input");
                            Answer.setAttribute("type", "text");
                            Answer.id = "capacityCharge" + i;
                            Answer.classList.add("form-control");
                            inputGroup.appendChild(Answer);
                        }
                }
                
                function ChargePageAnswers()
                {
                    capacityCharges = [];
                    var Continue = true;
                    if(isCapacityCharge)
                    {
                        if(capacityMeterSizes == null || capacityMeterSizes == [])
                        {
                            alert("You must select a Meter Size");
                        }
                        else
                        {
                            for(var i = 0; i < capacityMeterSizes.length; ++i)
                            {
                                var temp = document.getElementById("capacityCharge" + i);
                                if(temp.value == "")
                                    alert("A value must be enter for Meter Size " + capacityMeterSizes[i].replace('<QUOTE>', '"'));
                                else
                                {
                                    var regex = /^\d+(?:.\d{2})$/.test(temp.value);
                                    if(regex)
                                        capacityCharges.push(temp.value);
                                    else
                                    {
                                        alert("Charge Must be entered in the format  15.99");
                                        Continue = false;
                                        i = capacityMeterSizes.length;
                                    }
                                }
                            }
                            if(Continue)
                            {
                                RateStructure(0);
                            }
                        }
                    }
                    else
                    {
                        RateStructure(0);
                    }
                }
                
                //Creates All Rate Structure/Customer Class Pages
                function RateStructure(index)
                {
                    //Sets title to Utility Name and Subtitle to Cusstomer class and Clears page
                    title.innerHTML = UtilityName;
                    subtitle.innerHTML = SelectedRateStructures[index];
                    clear(form);
                    
                    //Populates The Service Charge Div
                    var serviceList = document.createElement("div");
                    serviceList.id = "serviceList";
                    form.appendChild(serviceList);
                    
                    QuestionTxt(survey.questions[4], 5, serviceList);
                    
                    Answer = document.createElement("span");
                    
                    //
                    if(isServiceCharge[currentIndex])
                    {
                        Answer.innerHTML = '<label for = "YesServiceCharge" class = "radio-inline"><input type = "radio" id = "YesServiceCharge" name = "isServiceCharge" onclick = "serviceChargeDepends()" value = "Yes" checked = "true"/>Yes</label>'+
                        '<label for = "NoServiceCharge" class ="radio-inline"><input type = "radio" id = "NoServiceCharge" name = "isServiceCharge" onclick = "serviceChargeTheSame()" value = "No" />No</label>';
                        serviceList.appendChild(Answer);
                        serviceChargeTheSame();
                    }
                    else
                    {  
                        Answer.innerHTML = '<label for = "YesServiceCharge" class ="radio-inline"><input type = "radio" id = "YesServiceCharge" name = "isServiceCharge" onclick = "serviceChargeTheSame()" value = "Yes" />Yes</label>'+
                        '<label for = "NoServiceCharge" class ="radio-inline"><input type = "radio" id = "NoServiceCharge" name = "isServiceCharge" onclick = "serviceChargeTheSame()" value = "No"  checked = "true"/>No</label>';
                        serviceList.appendChild(Answer);
                    }
                    
                    var commodityList = document.createElement("div");
                    commodityList.id = "commodityList";
                    form.appendChild(commodityList);
                    
                    QuestionTxt(survey.questions[6], 9, commodityList);
                    
                    Answer = document.createElement("span");
                    
                    if(isCommodityCharge[currentIndex])
                    {
                        Answer.innerHTML = '<label for = "YesCommodityCharge" class = "radio-inline"><input type = "radio" id = "YesCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "Yes" checked = "true"/>Yes</label>'+
                        '<label for = "NoCommodityCharge" class = "radio-inline"><input type = "radio" id = "NoCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "No" />No</label>';
                        commodityList.appendChild(Answer);
                        getCommodityChargeInfo();
                    }
                    else
                    {  
                        Answer.innerHTML = '<label for = "YesCommodityCharge" class = "radio-inline"><input type = "radio" id = "YesCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "Yes" />Yes</label>'+
                        '<label for = "NoCommodityCharge" class = "radio-inline"><input type = "radio" id = "NoCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "No"  checked = "true"/>No</label>';
                        commodityList.appendChild(Answer);
                    }
                    
                    //Buttons To Move To Previous Page Or Next Page
                    var ButtonDiv = document.createElement("div");
                    ButtonDiv.style.marginTop = "15px";
                    form.appendChild(ButtonDiv);
                    
                    
                    var Button = document.createElement("span");
                    if(currentIndex == SelectedRateStructures.length - 1)
                    {
                        Button.innerHTML = '<button type = "button" style = "margin-right: 10px" onclick = "PreviousGetAnswers()" class ="btn">Previous</button>' + 
                        '<button type = "button" onclick = "NextGetAnswers()" class = "btn">Complete</button>';
                    }
                    else
                    {
                        Button.innerHTML = '<button type = "button" style = "margin-right: 10px" onclick = "PreviousGetAnswers()" class = "btn">Previous</button>' + 
                        '<button type = "button" onclick = "NextGetAnswers()"class = "btn">Next</button>';
                    }
                    ButtonDiv.appendChild(Button);
                }
                
                //Checks if The Service Charge is The Same as a Previously Service Charge If it is the same it calls the getServiceSame() Function
                //If it isn't it goes to serviceChargeDepends()
                function  serviceChargeTheSame()
                {
                    //
                    var RadioButton = document.getElementById("YesServiceCharge");
                    isServiceCharge[currentIndex] = RadioButton.checked;
                    
                    //if rate structure has a service charge
                    if(RadioButton.checked == true)
                    {
                        // if not the first entry
                        if(currentIndex > 0)
                        {
                            QuestionTxt("Is this service charge the same as a previously entered service charge?", 42, serviceList);
                            Answer = document.createElement("span");
                        
                            Answer.innerHTML = '<label for = "YesServiceSame" class = "radio-inline"><input type = "radio" id = "YesServiceSame" name = "isServiceSame" onclick = "getServiceSame()" value = "Yes" />Yes</label>'+
                            '<label for = "NoServiceSame" class ="radio-inline"><input type = "radio" id = "NoServiceSame" name = "isServiceSame" onclick = "getServiceSame()" value = "No" />No</label>';
                            serviceList.appendChild(Answer);
                            
                            var serviceSame = document.createElement("div");
                            serviceSame.id = "serviceSameDiv";
                            serviceList.appendChild(serviceSame);
                            
                            // if data already exists
                            if(isServiceSame[currentIndex] != null)
                            {
                                //is same as previous cust class
                                if(isServiceSame[currentIndex])
                                {
                                    var temp = document.getElementById("YesServiceSame");
                                    temp.checked = true;
                                    
                                    getServiceSame();
                                }
                                //not same as a previous cust class
                                else
                                {
                                    var temp = document.getElementById("NoServiceSame");
                                    temp.checked = true;
                                    
                                    serviceChargeDepends();
                                }
                            }
                        }
                        //is the first customer class
                        else
                        {
                            var service = document.createElement("div");
                            service.id = "serviceSameDiv";
                            serviceList.appendChild(service);
                        
                            serviceChargeDepends();
                        }
                    }
                    //no service charge
                    else
                    {
                        clear(serviceList);
                        serviceParameters[currentIndex] = [];
                        
                        QuestionTxt(survey.questions[4], 5, serviceList);
                        
                        Answer = document.createElement("span");
                    
                        Answer.innerHTML = '<label for = "YesServiceCharge" class ="radio-inline"><input type = "radio" id = "YesServiceCharge" name = "isServiceCharge" onclick = "serviceChargeTheSame()" value = "Yes" />Yes</label>'+
                        '<label for = "NoServiceCharge" class ="radio-inline"><input type = "radio" id = "NoServiceCharge" name = "isServiceCharge" onclick = "serviceChargeTheSame()" value = "No"  checked = "true"/>No</label>';
                        serviceList.appendChild(Answer);
                    }
                }
                
                
                //populates dropdown list of previous customer classes
                //
                //after selection, calls serviceSameValues to get the service charge data for that class
                function getServiceSame()
                {
                    var serviceSame = document.getElementById("serviceSameDiv")
                    
                    var radiobutton = document.getElementById("YesServiceSame");
                    if(radiobutton.checked)
                    {
                        if(serviceSame.childNodes.length> 0)
                            clear(serviceSame);
                        
                        isServiceSame[currentIndex] = true;
                        
                        QuestionTxt("Select which Service Charge is the Same?", 78, serviceSame);
                        
                        Answer = document.createElement("select");
                
                        for(var i = 0; i < currentIndex; ++i)
                        {
                            Answer.appendChild(new Option(SelectedRateStructures[i], i));
                        }
                        Answer.id = "serviceSame";
                        Answer.classList.add("form-control");
                        if(serviceSameStructure[currentIndex] != null)
                        {
                            Answer.value = serviceSameStructure[currentIndex];
                        }
                        Answer.setAttribute("onchange", "serviceSameValues()");
                        serviceSame.appendChild(Answer);
                        serviceSameValues();
                    }
                    else
                    {
                        if(serviceSame.childNodes.length> 0)
                            clear(serviceSame);
                        
                        serviceChargeDepends();
                    }
                }
                
                //gets service charge data from previously entered class
                //populates the variables related to service charge
                function serviceSameValues()
                {
                    serviceSameStructure[currentIndex] = document.getElementById("serviceSame").value;
                    var temp = serviceSameStructure[currentIndex];
                    
                    isServiceDepends[currentIndex] = isServiceDepends[temp];
                    serviceParameters[currentIndex] = serviceParameters[temp];
                    serviceChargeCategories[currentIndex] = serviceChargeCategories[temp];
                    serviceCharges[currentIndex] = serviceCharges[temp];
                    if(serviceParameters[temp] != null)
                    {
                        if(serviceParameters[temp].length > 0)
                        {
                            if(season[temp][3] != null)
                            {
                                season[currentIndex] = [];
                                season[currentIndex][3] = season[temp][3];
                            }
                            if(temperatureZone[temp][3] != null)
                            {
                                temperatureZone[currentIndex] = [];
                                temperatureZone[currentIndex][3] = temperatureZone[temp][3];
                            }
                            if(elevationZone[temp][3] != null)
                            {
                                elevationZone[currentIndex] = []; 
                                elevationZone[currentIndex][3] = elevationZone[temp][3];
                            }
                            if(pressureZone[temp][3] != null)
                            {
                                pressureZone[currentIndex] = [];
                                pressureZone[currentIndex][3] = pressureZone[temp][3];
                            }
                            if(lotSizeGroup[temp][3] != null)
                            {
                                lotSizeGroup[currentIndex] = [];
                                lotSizeGroup[currentIndex][3] = lotSizeGroup[temp][3];
                            }
                            if(month[temp][3] != null)
                            {
                                month[currentIndex] = [];
                                month[currentIndex][3] = month[temp][3];
                            }
                            if(commodityMeterSize[temp][3] != null)
                            {
                                commodityMeterSize[currentIndex] = [];
                                commodityMeterSize[currentIndex][3] = commodityMeterSize[temp][3];
                            }
                            if(meterType[temp][3] != null)
                            {
                                meterType[currentIndex] = [];
                                meterType[currentIndex][3] = meterType[temp][3];
                            }
                            if(area[temp][3] != null)
                            {
                                area[currentIndex] = [];
                                area[currentIndex][3] = area[temp][3];
                            }
                        }
                    }
                }
                
                //sets the YesServiceDepends button based on program state
                function serviceChargeDepends()
                {
                    var serviceSame = document.getElementById("serviceSameDiv");
                    
                    QuestionTxt("Does the service charge depend on anything?", 25, serviceSame);
                    Answer = document.createElement("span");
                        
                    Answer.innerHTML = '<label for = "YesServiceDepends" class = "radio-inline"><input type = "radio" id = "YesServiceDepends" name = "isServiceDepends" onclick = "getServiceChargeInfo()" value = "Yes" />Yes</label>'+
                    '<label for = "NoServiceDepends" class ="radio-inline"><input type = "radio" id = "NoServiceDepends" name = "isServiceDepends" onclick = "getServiceChargeInfo()" value = "No" checked = "true"/>No</label>';
                    serviceSame.appendChild(Answer);
                        
                    var service = document.createElement("div");
                    service.id = "serviceStuffDiv";
                    serviceSame.appendChild(service);
                        
                    if(isServiceDepends[currentIndex])
                    {
                        var temp = document.getElementById("YesServiceDepends");
                        temp.checked = true;
                    }
                        
                    getServiceChargeInfo();
                    
                }
                
                //based on whether YesServiceDepends is yes or no,
                //yes: calls getDepends to populate checklist of depend parameters
                //no: creates numeric input for service charge
                function getServiceChargeInfo()
                {
                    var RadioButton = document.getElementById("YesServiceDepends");
                    isServiceDepends[currentIndex] = RadioButton.checked;
                    
                    var service = document.getElementById("serviceStuffDiv");
                    
                    if(RadioButton.checked == true)
                    {
                        primeParamArrays();
                        
                        if(service.childNodes.length > 0)
                            clear(service);
                        
                        var serviceParametersDiv = document.createElement("div");
                        serviceParametersDiv.id = "serviceParametersDiv";
                        service.appendChild(serviceParametersDiv);
                    
                        var serviceParametersValueDiv = document.createElement("div");
                        serviceParametersValueDiv.id = "serviceParametersValueDiv";
                        service.appendChild(serviceParametersValueDiv);
                    
                        var servicePriceDiv = document.createElement("div");
                        servicePriceDiv.id = "servicePriceDiv";
                        service.appendChild(servicePriceDiv);
                        
                        getDepends(serviceParametersDiv, serviceParameters[currentIndex], "service");
                    }
                    else
                    {
                        serviceParameters[currentIndex] = [];
                        
                        if(service.childNodes.length > 0)
                            clear(service);
                        
                        QuestionTxt("Enter the Service Charge (In the form of 15.99):", 512, service);
                        
                        divider = document.createElement("div");
                        divider.classList.add("form-group");
                        service.appendChild(divider);
                        
                        inputGroup = document.createElement("div");
                        inputGroup.classList.add("input-group");
                        divider.appendChild(inputGroup);
                        
                        Answer = document.createElement("span");
                        Answer.classList.add("input-group-addon");
                        Answer.innerHTML = '<i class="glyphicon glyphicon-usd"></i>';
                        inputGroup.appendChild(Answer);
                        
                        Answer = document.createElement("input");
                        Answer.setAttribute("type", "text");
                        Answer.id = "ServiceCharge";
                        Answer.classList.add("form-control");
                        inputGroup.appendChild(Answer);
                        
                        if(serviceCharges[currentIndex] != null)
                        {
                            if(serviceCharges[currentIndex].length == 1)
                            {
                                Answer.value = serviceCharges[currentIndex][0];
                            }
                            else
                                serviceCharges[currentIndex] = [];
                        }
                    }
                }
                
                //creates numeric inputs for each category of each depend parameter
                function getServiceRate()
                {
                    
                    if(servicePriceDiv.childNodes.length > 0)
                    {
                        clear(servicePriceDiv);
                    }
                    
                    createUsedParameters(serviceParameters[currentIndex], 3);
                        
                    var Continue = true;
                            
                    for(var i = 0; i < ParametersToUse.length; ++i)
                    {
                        if(ParametersToUse[i] == null)
                        {
                            Continue = false;
                            i = ParametersToUse.length;
                        }
                    }
                            
                    if(Continue && ParametersToUse.length > 0)
                    {
                        QuestionTxt("Enter The Service Charge(In the form of 15.99):", 43, servicePriceDiv)
                        serviceChargeCategories[currentIndex] = [];
                        getCategories(serviceChargeCategories[currentIndex], 0, ParametersToUse.length, "", "Rate:");
                            
                        
                        for(var i = 0; i < serviceChargeCategories[currentIndex].length; ++i)
                        {
                            divider = document.createElement("div");
                            divider.classList.add("form-group");
                            servicePriceDiv.appendChild(divider);
                                    
                            Answer = document.createElement("label");
                            Answer.setAttribute("for", "serviceCharge" + i);
                            Answer.appendChild(document.createTextNode(serviceChargeCategories[currentIndex][i].split("<QUOTE>").join("")));
                            divider.appendChild(Answer);
                                
                            inputGroup = document.createElement("div");
                            inputGroup.classList.add("input-group");
                            divider.appendChild(inputGroup);
                                    
                            Answer = document.createElement("span");
                            Answer.classList.add("input-group-addon");
                            Answer.innerHTML = '<i class="glyphicon glyphicon-usd"></i>';
                            inputGroup.appendChild(Answer);
                                
                            Answer = document.createElement("input");
                            Answer.setAttribute("type", "text");
                            Answer.id = "serviceCharge" + i;
                            Answer.classList.add("form-control");
                            inputGroup.appendChild(Answer);
                        }
                            
                        if(serviceCharges[currentIndex] != null && serviceChargeCategories[currentIndex] != null)
                        {
                            if(serviceCharges[currentIndex].length == serviceChargeCategories[currentIndex].length)
                            {
                                for(var i = 0; i < serviceCharges[currentIndex].length; ++i)
                                {
                                    var input = document.getElementById("serviceCharge" + i);
                                    input.value = serviceCharges[currentIndex][i];
                                }
                            }
                         }
                    }
                    
                }
                
                // checks if YesCommodityCharge is yes or no 
                //yes: create radio buttons to choose between uniform/tiered/budget
                function getCommodityChargeInfo()
                {
                    var RadioButton = document.getElementById("YesCommodityCharge");
                    
                    isCommodityCharge[currentIndex] = RadioButton.checked;
                    
                    if(RadioButton.checked == true)
                    {
                        QuestionTxt(survey.questions[7], 10, commodityList);
                        
                        Answer = document.createElement("span");
                        Answer.innerHTML = '<label for = "Uniform" class = "radio-inline"><input type = "radio" id = "Uniform" name = "CommodityStructure" onclick = "UniformDepends()" value = "Uniform"/>Uniform</label>'+
                        '<label for = "Tiered" class = "radio-inline"><input type = "radio" id = "Tiered" name = "CommodityStructure" onclick = "TieredDepends()" value = "Tiered"/>Tiered</label>'+
                        '<label for = "Budget" class = "radio-inline"><input type = "radio" id = "Budget" name = "CommodityStructure" onclick = "BudgetDepends()" value = "Budget"/>Budget</label>';
                        
                        commodityList.appendChild(Answer);
                        
                        var commodityDependsOnDiv = document.createElement("div");
                        commodityDependsOnDiv.id = "commodityDependsOnDiv";
                        commodityList.appendChild(commodityDependsOnDiv);
                    }
                    else
                    {
                        clear(commodityList);
                        commodityStructure[currentIndex] = [];
                        
                        QuestionTxt(survey.questions[6], 9, commodityList);
                        
                        Answer = document.createElement("span");
                        
                        Answer.innerHTML = '<label for = "YesCommodityCharge" class = "radio-inline"><input type = "radio" id = "YesCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "Yes" />Yes</label>'+
                        '<label for = "NoCommodityCharge" class = "radio-inline"><input type = "radio" id = "NoCommodityCharge" name = "isCommodityCharge" onclick = "getCommodityChargeInfo()" value = "No"  checked = "true"/>No</label>';
                        commodityList.appendChild(Answer);
                    }
                    
                    if(commodityStructure[currentIndex] == 'Uniform')
                    {
                        var Radio = document.getElementById("Uniform");
                        Radio.checked = true;
                        
                        UniformDepends();
                    }
                    else if(commodityStructure[currentIndex] == 'Tiered')
                    {
                        var Radio = document.getElementById("Tiered");
                        Radio.checked = true;
                        
                        TieredDepends();
                    }
                    else if(commodityStructure[currentIndex] == 'Budget')
                    {
                        var Radio = document.getElementById("Budget");
                        Radio.checked = true;
                        
                        BudgetDepends();
                    }
                }
                
                //fill param arrays with empty subarrays
                function primeParamArrays()
                {
                    if(season[currentIndex] == null)
                        season[currentIndex] = [];
                    if(temperatureZone[currentIndex] == null)
                        temperatureZone[currentIndex] = [];
                    if(elevationZone[currentIndex] == null)
                        elevationZone[currentIndex] = []; 
                    if(pressureZone[currentIndex] == null)
                        pressureZone[currentIndex] = [];
                    if(lotSizeGroup[currentIndex] == null)
                        lotSizeGroup[currentIndex] = [];
                    if(month[currentIndex] == null)
                        month[currentIndex] = [];
                    if(commodityMeterSize[currentIndex] == null)
                        commodityMeterSize[currentIndex] = [];
                    if(meterType[currentIndex] == null)
                        meterType[currentIndex] = [];
                    if(area[currentIndex] == null)
                        area[currentIndex] = [];
                }
                
                //clear and populate the commodityDependsOnDiv with options for uniform rates
                function UniformDepends()
                {
                    commodityStructure[currentIndex] = 'Uniform';
                    
                    primeParamArrays();
                    
                    var commodityDependsOnDiv = document.getElementById("commodityDependsOnDiv");
                    if(commodityDependsOnDiv.childNodes.length > 0)
                    {
                        clear(commodityDependsOnDiv);
                    }
                    
                    QuestionTxt(survey.questions[8], 11, commodityDependsOnDiv);
                    
                    Answer = document.createElement("span");
                        
                    Answer.innerHTML = '<label for = "YesUniformDepends" class = "radio-inline"><input type = "radio" id = "YesUniformDepends" name = "isUniformDependsOn" onclick = "getDepends(uniformParametersDiv, uniformParameters[currentIndex], \'uniform\')" value = "Yes" />'+
                    'Yes</label>'+
                    '<label for = "NoUniformDepends" class = "radio-inline"><input type = "radio" id = "NoUniformDepends" name = "isUniformDependsOn" onclick = "getUniformRate()" value = "No"/>'+
                    'No</label>';
                        
                    commodityDependsOnDiv.appendChild(Answer);
                    
                    var uniformParametersDiv = document.createElement("div");
                    uniformParametersDiv.id = "uniformParametersDiv";
                    commodityDependsOnDiv.appendChild(uniformParametersDiv);
                    
                    var uniformParametersValueDiv = document.createElement("div");
                    uniformParametersValueDiv.id = "uniformParametersValueDiv";
                    commodityDependsOnDiv.appendChild(uniformParametersValueDiv);
                    
                    var uniformPriceDiv = document.createElement("div");
                    uniformPriceDiv.id = "uniformPriceDiv";
                    commodityDependsOnDiv.appendChild(uniformPriceDiv);
                    
                    if(isUniformDependsOn[currentIndex] == 'Yes')
                    {
                        var Radio = document.getElementById("YesUniformDepends");
                        Radio.checked = true;
                        getDepends(uniformParametersDiv, uniformParameters[currentIndex], "uniform");
                    }
                    else if(isUniformDependsOn[currentIndex] == 'No')
                    {
                        var Radio = document.getElementById("NoUniformDepends");
                        Radio.checked = true;
                        getUniformRate();
                    }
                }
                
                //
                function getUniformRate()
                {
                    var Radio = document.getElementById("NoUniformDepends");
                    
                    if(uniformPriceDiv.childNodes.length > 0)
                    {
                        clear(uniformPriceDiv);
                    }
                    
                    if(Radio.checked)
                    {
                        isUniformDependsOn[currentIndex] = 'No';
                        
                        var uniformParametersDiv = document.getElementById("uniformParametersDiv");
                        if(uniformParametersDiv.childNodes.length > 0)
                        {
                            clear(uniformParametersDiv);
                        }
                        if(uniformParametersValueDiv.childNodes.length > 0)
                        {
                            clear(uniformParametersValueDiv);
                        }
                    }
                    else
                    {
                        isUniformDependsOn[currentIndex] = 'Yes';
                    }
                    
                    if(isUniformDependsOn[currentIndex] == 'Yes')
                    {
                        createUsedParameters(uniformParameters[currentIndex], 0);
                        
                            var Continue = true;
                            
                            for(var i = 0; i < ParametersToUse.length; ++i)
                            {
                                if(ParametersToUse[i] == null)
                                {
                                    Continue = false;
                                    i = ParametersToUse.length;
                                }
                            }
                            
                            if(Continue && ParametersToUse.length > 0)
                            {
                                QuestionTxt("Enter The Cost Per CCF(In the form of 15.99):", 12, uniformPriceDiv)
                                commodityChargeCategories[currentIndex] = [];
                                getCategories(commodityChargeCategories[currentIndex], 0, ParametersToUse.length, "", "Rate:");
                            
                        
                                for(var i = 0; i < commodityChargeCategories[currentIndex].length; ++i)
                                {
                                    divider = document.createElement("div");
                                    divider.classList.add("form-group");
                                    uniformPriceDiv.appendChild(divider);
                                    
                                    Answer = document.createElement("label");
                                    Answer.setAttribute("for", "commodityCharge" + i);
                                    Answer.appendChild(document.createTextNode(commodityChargeCategories[currentIndex][i].split("<QUOTE>").join("")));
                                    divider.appendChild(Answer);
                                
                                    inputGroup = document.createElement("div");
                                    inputGroup.classList.add("input-group");
                                    divider.appendChild(inputGroup);
                                    
                                    Answer = document.createElement("span");
                                    Answer.classList.add("input-group-addon");
                                    Answer.innerHTML = '<i class="glyphicon glyphicon-usd"></i>';
                                    inputGroup.appendChild(Answer);
                                
                                    Answer = document.createElement("input");
                                    Answer.setAttribute("type", "text");
                                    Answer.id = "commodityCharge" + i;
                                    Answer.classList.add("form-control");
                                    inputGroup.appendChild(Answer);
                                }
                            
                                if(commodityCharges[currentIndex] != null && commodityChargeCategories[currentIndex] != null)
                                {
                                    if(commodityCharges[currentIndex].length == commodityChargeCategories[currentIndex].length)
                                    {
                                        for(var i = 0; i < commodityCharges[currentIndex].length; ++i)
                                        {
                                            var input = document.getElementById("commodityCharge" + i);
                                            input.value = commodityCharges[currentIndex][i];
                                        }
                                    }
                                }
                            }
                    }
                    else if(isUniformDependsOn[currentIndex] == 'No')
                    {
                        QuestionTxt("Enter The Cost Per CCF(In the form of 15.99):", 12, uniformPriceDiv);
                       
                        inputGroup = document.createElement("div");
                        inputGroup.classList.add("input-group");
                        uniformPriceDiv.appendChild(inputGroup);
                                    
                        Answer = document.createElement("span");
                        Answer.classList.add("input-group-addon");
                        Answer.innerHTML = '<i class="glyphicon glyphicon-usd"></i>';
                        inputGroup.appendChild(Answer);
                                
                        Answer = document.createElement("input");
                        Answer.setAttribute("type", "text");
                        Answer.id = "commodityCharge0";
                        Answer.classList.add("form-control");
                        inputGroup.appendChild(Answer);
                        
                        if(commodityCharges[currentIndex] != null)
                        {
                            Answer = document.getElementById("commodityCharge0");
                            Answer.value = commodityCharges[currentIndex][0];
                        }
                    }
                }
                
                
                function TieredDepends()
                {
                    commodityStructure[currentIndex] = 'Tiered';
                    
                    primeParamArrays();
                    
                    var commodityDependsOnDiv = document.getElementById("commodityDependsOnDiv");
                    if(commodityDependsOnDiv.childNodes.length > 0)
                    {
                        clear(commodityDependsOnDiv);
                    }
                    
                    QuestionTxt(survey.questions[9], 11, commodityDependsOnDiv);
                    Answer = document.createElement("select");
                    Answer.classList.add("form-control");
                    for(var i = 2; i <= 6; ++i)
                    {
                        Answer.appendChild(new Option(i, i));
                    }
                    Answer.id = "numOfTiers";
                    if(tierLevels[currentIndex] != null)
                    {
                        Answer.value = tierLevels[currentIndex];
                    }
                    Answer.setAttribute("onchange", "createTierLevels()");
                    commodityDependsOnDiv.appendChild(Answer);
                    
                    var tierStartsDiv = document.createElement("div");
                    tierStartsDiv.id = "tierStartsDiv";
                    commodityDependsOnDiv.appendChild(tierStartsDiv);
                    
                    var tierPricesDiv = document.createElement("div");
                    tierPricesDiv.id = "tierPricesDiv";
                    commodityDependsOnDiv.appendChild(tierPricesDiv);
                    
                    createTierLevels();
                }
                
                function createTierLevels()
                {
                    var tiers = document.getElementById("numOfTiers");
                    tierLevels[currentIndex] = tiers.value;
                    
                    Tier("tierStartsDiv", survey.questions[10], 14, isTierStartsDepends[currentIndex], "TierStarts", getTierStartsInfo);
                    Tier("tierPricesDiv", survey.questions[12], 15, isTierPricesDepends[currentIndex], "TierPrices", getTierPricesInfo);
                    getTierStartsInfo();
                    getTierPricesInfo();
                }
                
                //creates a yes/no radio  button for whether tiers depend on something
                function Tier(DIV, question, qNumber, dependsOn, Identifier, Function)
                {
                    var tierDiv = document.getElementById(DIV);
                    if(tierDiv.childNodes.length > 0)
                    {
                        clear(tierDiv);
                    }
                    QuestionTxt(question, qNumber, tierDiv);
                    
                    if(dependsOn)
                    {
                        Answer = document.createElement("span");
                        
                        Answer.innerHTML = '<label for = "Yes' + Identifier + '" class = "radio-inline"><input type = "radio" id = "Yes' + Identifier + '" name = "is' + Identifier + 'Depends" onclick = "get' + Identifier + 'Info()" value = "Yes" checked = "true"/>'+
                        'Yes</label>'+
                        '<label for = "No' + Identifier + '" class = "radio-inline"><input type = "radio" id = "No' + Identifier + '" name = "is' + Identifier + 'Depends" onclick = "get' + Identifier + 'Info()" value = "No" />'+
                        'No</label>';
                        
                        tierDiv.appendChild(Answer);
                        
                        Function();
                    }
                    else
                    {
                        Answer = document.createElement("span");
                        
                        Answer.innerHTML = '<label for = "Yes' + Identifier + '" class = "radio-inline"><input type = "radio" id = "Yes' + Identifier + '" name = "is' + Identifier + 'Depends" onclick = "get' + Identifier + 'Info()" value = "Yes"/>'+
                        'Yes</label>'+
                        '<label for = "No' + Identifier + '" class = "radio-inline"><input type = "radio" id = "No' + Identifier + '" name = "is' + Identifier + 'Depends" onclick = "get' + Identifier + 'Info()" value = "No" checked = "true"/>'+
                        'No</label>';
                        
                        tierDiv.appendChild(Answer);
                    }
                }
                
                //checks value of YesTierStarts radio button
                //yes: calls getDepends to create depends checklist
                //no: calles createTierFields to create tier fields
                function getTierStartsInfo()
                {
                    var Radio = document.getElementById("YesTierStarts");
                    
                    if(Radio.checked)
                    {
                        isTierStartsDepends[currentIndex] = true;
                        if(tierStartsDiv.childNodes.length > 0)
                        {
                            clear(tierStartsDiv);
                        }
                        QuestionTxt(survey.questions[10], 14,tierStartsDiv)
                        Answer = document.createElement("span");
                        
                        Answer.innerHTML = '<label for = "YesTierStarts" class = "radio-inline"><input type = "radio" id = "YesTierStarts" name = "isTierStartsDepends" onclick = "getTierStartsInfo()" value = "Yes" checked = "true"/>'+
                        'Yes</label>'+
                        '<label for = "NoTierStarts" class = "radio-inline"><input type = "radio" id = "NoTierStarts" name = "isTierStartsDepends" onclick = "getTierStartsInfo()" value = "No" />'+
                        'No</label>';
                        
                        tierStartsDiv.appendChild(Answer);
                        
                        var tierStartsParameterDiv = document.createElement("div");
                        tierStartsParameterDiv.id = "tierStartsParameterDiv";
                        tierStartsDiv.appendChild(tierStartsParameterDiv);
                        
                        var tierStartsParameterValueDiv = document.createElement("div");
                        tierStartsParameterValueDiv.id = "tierStartsParameterValueDiv";
                        tierStartsDiv.appendChild(tierStartsParameterValueDiv);
                        
                        var tierStartsValuesDiv = document.createElement("div");
                        tierStartsValuesDiv.id = "tierStartsValuesDiv";
                        tierStartsDiv.appendChild(tierStartsValuesDiv);
                        
                        getDepends(tierStartsParameterDiv, tierStartsParameters[currentIndex], 'tierStarts');
                    }
                    else
                    {
                        isTierStartsDepends[currentIndex] = false;
                        Tier("tierStartsDiv", survey.questions[10], 14, isTierStartsDepends[currentIndex], "TierStarts", getTierStartsInfo);
                        
                        Answer = document.createElement('div');
                        Answer.id = "tierStartsValuesDIV";
                        tierStartsDiv.appendChild(Answer);
                        
                        tierStartsCategories[currentIndex] = [""];
                        
                        if(commodityStructure == "Tiered")
                        {
                            createTierFields(Answer, "tierStarts", tierStartsCategories[currentIndex], "Tier Levels (As an Integer):");
                        }
                        else
                        {
                            createTierFields(Answer, "tierStarts", tierStartsCategories[currentIndex], "Tier Levels (As a percent like 100%):");
                        }
                    }
                }
                
                //checks value of YesTierPrices radio button
                //yes: calls getDepends to create depends checklist
                //no: calles createTierFields to create tier fields for prices
                function getTierPricesInfo()
                {
                    var Radio = document.getElementById("YesTierPrices");
                    
                    if(Radio.checked)
                    {
                        isTierPricesDepends[currentIndex] = true;
                        if(tierPricesDiv.childNodes.length > 0)
                        {
                            clear(tierPricesDiv);
                        }
                        QuestionTxt(survey.questions[12], 15,tierPricesDiv)
                        Answer = document.createElement("span");
                        
                        Answer.innerHTML = '<label for = "YesTierPrices" class = "radio-inline"><input type = "radio" id = "YesTierPrices" name = "isTierPricesDepends" onclick = "getTierPricesInfo()" value = "Yes" checked = "true"/>'+
                        'Yes</label>'+
                        '<label for = "NoTierPrices" class = "radio-inline"><input type = "radio" id = "NoTierPrices" name = "isTierPricesDepends" onclick = "getTierPricesInfo()" value = "No" />'+
                        'No</label>';
                        
                        tierPricesDiv.appendChild(Answer);
                        
                        var tierPricesParameterDiv = document.createElement("div");
                        tierPricesParameterDiv.id = "tierPricesParameterDiv";
                        tierPricesDiv.appendChild(tierPricesParameterDiv);
                        
                        var tierPricesParameterValueDiv = document.createElement("div");
                        tierPricesParameterValueDiv.id = "tierPricesParameterValueDiv";
                        tierPricesDiv.appendChild(tierPricesParameterValueDiv);
                        
                        var tierPricesValuesDiv = document.createElement("div");
                        tierPricesValuesDiv.id = "tierPricesValuesDiv";
                        tierPricesDiv.appendChild(tierPricesValuesDiv);
                        
                        getDepends(tierPricesParameterDiv, tierPricesParameters[currentIndex], 'tierPrices');
                    }
                    else
                    {
                        isTierPricesDepends[currentIndex] = false;
                        Tier("tierPricesDiv", survey.questions[12], 15, isTierPricesDepends[currentIndex], "TierPrices", getTierPricesInfo);
                        
                        Answer = document.createElement('div');
                        Answer.id = "tierPricesValuesDIV";
                        tierPricesDiv.appendChild(Answer);
                        
                        commodityChargeCategories[currentIndex] = [""];
                        
                        createTierFields(Answer, "tierPrices", commodityChargeCategories[currentIndex], "Tier Prices (In the Form of 15.99):")
                    }
                }
                
                //create budget equation fields
                function budgetVariableFieldCreator(DIV, id, Text, glyphicon, valueArray, defaultValue)
                {
                    divider = document.createElement("div");
                    divider.classList.add("form-group");
                    DIV.appendChild(divider);
                   
                    Answer = document.createElement("label");
                    Answer.setAttribute("for", id);
                    Answer.appendChild(document.createTextNode(Text));
                    divider.appendChild(Answer);
                        
                    inputGroup = document.createElement("div");
                    inputGroup.classList.add("input-group");
                    divider.appendChild(inputGroup);
                        
                    Answer = document.createElement("span");
                    Answer.classList.add("input-group-addon");
                    Answer.innerHTML = '<i class="glyphicon glyphicon-tint"></i><i class="glyphicon ' + glyphicon + '"></i>';
                    inputGroup.appendChild(Answer);
                    
                    Answer = document.createElement("input");
                    Answer.setAttribute("type", "text");
                    Answer.classList.add("form-control");
                    Answer.id = id;
                    if(valueArray != null)
                    {
                        Answer.value = valueArray;
                    }
                    else
                    {
                        Answer.value = defaultValue;
                    }
                    inputGroup.appendChild(Answer);
                    
                }
                
                // create dropdown of number of tiers along with yes/no radio button for if tiers depend on something
                function BudgetDepends()
                {
                    commodityStructure[currentIndex] = 'Budget';
                    primeParamArrays();
                    
                    var commodityDependsOnDiv = document.getElementById("commodityDependsOnDiv");
                    if(commodityDependsOnDiv.childNodes.length > 0)
                    {
                        clear(commodityDependsOnDiv);
                    }
                    
                    QuestionTxt("Enter the Values Below:", 17, commodityDependsOnDiv);
                    
                    
                    budgetVariableFieldCreator(commodityDependsOnDiv, "gpcd", "Gallons Per Capita Day:", "glyphicon-user", gpcd[currentIndex], "60");
                    budgetVariableFieldCreator(commodityDependsOnDiv, "landscape_factor", "Landscape Factor:", "glyphicon-grain", landscape_factor[currentIndex], ".7");
                    budgetVariableFieldCreator(commodityDependsOnDiv, "indoor", "Indoor Budget Equation:", "glyphicon-home", indoor[currentIndex], "hhsize*gpcd*days_in_period*(1/748)");
                    budgetVariableFieldCreator(commodityDependsOnDiv, "outdoor", "Outdoor Budget Equation:", "glyphicon-globe", gpcd[currentIndex], "landscape_factor*et_amount*irr_area*0.62*(1/748)");
                    budgetVariableFieldCreator(commodityDependsOnDiv, "budget", "Budget:", "glyphicon-usd", budget[currentIndex], "indoor+outdoor");
                    
                    
                    QuestionTxt(survey.questions[9], 11, commodityDependsOnDiv);
                    Answer = document.createElement("select");
                    for(var i = 2; i <= 6; ++i)
                    {
                        Answer.appendChild(new Option(i, i));
                    }
                    Answer.id = "numOfTiers";
                    Answer.classList.add("form-control");
                    if(tierLevels[currentIndex] != null)
                    {
                        if(tierLevels[currentIndex] < 2)
                        {
                            Answer.value = 2;
                        }
                        else
                        {
                            Answer.value = tierLevels[currentIndex];
                        }
                    }
                    Answer.setAttribute("onchange", "createTierLevels()");
                    commodityDependsOnDiv.appendChild(Answer);
                    
                    var tierStartsDiv = document.createElement("div");
                    tierStartsDiv.id = "tierStartsDiv";
                    commodityDependsOnDiv.appendChild(tierStartsDiv);
                    
                    var tierPricesDiv = document.createElement("div");
                    tierPricesDiv.id = "tierPricesDiv";
                    commodityDependsOnDiv.appendChild(tierPricesDiv);
                    
                    createTierLevels();
                }
                
                //create depends checklist and populates based on program state
                function getDepends(DIV, identifier, Structure)
                {
                    if(DIV.childNodes.length > 0)
                    {
                        clear(DIV);
                    }
                    QuestionTxt(survey.questions[11] ,13, DIV);
                    
                    for(var i = 0; i < survey.commodityDependsOn.length; ++i)
                    {
                        var divider = document.createElement("div");
                        divider.classList.add("checkbox");
                        var checkboxID = Structure + "DependsOn" + i;
                        divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "CommodityDependsOn" onclick = "storeCommodityDepends(\'' + Structure + '\')" value ="' + survey.commodityDependsOn[i]+ '"/>'+
                        '' + survey.commodityDependsOn[i] + '</label>';
                        DIV.appendChild(divider);
                    }
                    
                    
                    if(identifier != null)
                    {
                        for(var i = 0; i < survey.commodityDependsOn.length; ++i)
                        {
                            var checkCheckBox = document.getElementById(Structure + "DependsOn" + i)
                            for(var j = 0; j < identifier.length; ++j)
                            {
                                if(identifier[j] == checkCheckBox.value)
                                {
                                    checkCheckBox.checked = true;
                                }
                            }
                        }
                        storeCommodityDepends(Structure);
                    }
                    
                }
                
                // save the values of the various  depends checklists (tiered, service, budget, etc) into global params
                function storeCommodityDepends(tierIdentifier)
                {
                    if(tierIdentifier == 'uniform')
                    {
                        uniformParameters[currentIndex] = [];
                        pushParameters(uniformParameters[currentIndex], 'uniform');
                        
                        if(uniformParametersValueDiv.childNodes.length >  0)
                        {
                            clear(uniformParametersValueDiv);
                        }
                        
                        for(var i = 0; i < uniformParameters[currentIndex].length; ++i)
                        {
                            getParameterValues(uniformParameters[currentIndex][i], uniformParametersValueDiv, 'Uniform', 0);
                        }
                        clearParametersNotUsed(uniformParameters[currentIndex], 0);
                        commodityChargeCategories[currentIndex] = null;
                        getUniformRate();
                    }
                    else if(tierIdentifier == 'tierStarts' || tierIdentifier == 'tierPrices')
                    {
                        if(tierIdentifier == "tierStarts")
                        {
                            tierStartsParameters[currentIndex] = [];
                            pushParameters(tierStartsParameters[currentIndex], tierIdentifier);
                            
                            var tierStartsParameterValueDiv = document.getElementById("tierStartsParameterValueDiv");
                            if(tierStartsParameterValueDiv.childNodes.length > 0)
                            {
                                clear(tierStartsParameterValueDiv);
                            }
                            
                            clearParametersNotUsed(tierStartsParameters[currentIndex], 1);
                            tierStartsCategories[currentIndex] = null;
                            
                            for(value in tierStartsParameters[currentIndex])
                            {
                                getParameterValues(tierStartsParameters[currentIndex][value], tierStartsParameterValueDiv, 'tierStarts', 1);
                            }
                            pushParameterValues('tierStarts');
                        }
                        else
                        {
                            tierPricesParameters[currentIndex] = [];
                            pushParameters(tierPricesParameters[currentIndex], tierIdentifier);
                            
                            var tierPricesParameterValueDiv = document.getElementById("tierPricesParameterValueDiv");
                            if(tierPricesParameterValueDiv.childNodes.length > 0)
                            {
                                clear(tierPricesParameterValueDiv);
                            }
                            
                            clearParametersNotUsed(tierPricesParameters[currentIndex], 2);
                            commodityChargeCategories[currentIndex] = null;
                            
                            for(value in tierPricesParameters[currentIndex])
                            {
                                getParameterValues(tierPricesParameters[currentIndex][value], tierPricesParameterValueDiv, 'tierPrices', 2);
                            }
                            pushParameterValues('tierPrices');
                        }
                    }
                    else if(tierIdentifier == "service")
                    {
                        serviceParameters[currentIndex] = [];
                        pushParameters(serviceParameters[currentIndex], tierIdentifier);
                        if(serviceParametersValueDiv.childNodes.length >  0)
                        {
                            clear(serviceParametersValueDiv);
                        }
                        
                        for(var i = 0; i < serviceParameters[currentIndex].length; ++i)
                        {
                            getParameterValues(serviceParameters[currentIndex][i], serviceParametersValueDiv, 'service', 3);
                        }
                        clearParametersNotUsed(serviceParameters[currentIndex], 3);
                        serviceChargeCategories[currentIndex] = null;
                        getServiceRate();
                    }
                }
                
                function pushParameters(STRUCTURE, identifier)
                {
                    for(var i = 0; i < survey.commodityDependsOn.length; ++i)
                    {
                        var checkCheckBox = document.getElementById(identifier + "DependsOn" + i);
                        
                        if(checkCheckBox.checked)
                        {
                            STRUCTURE.push(checkCheckBox.value);
                        }
                    }
                }
                
                function getParameterValues(parameter, DIV, identifier, tierIdentifier)
                {
                    QuestionTxt("Select the values for " + parameter ,13 , DIV)
                    
                    switch(parameter)
                    {
                        case 'Season': 
                            for(var i = 0; i < survey.season.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "Season" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'SeasonValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="' + survey.season[i]+ '"/>'+
                                '' + survey.season[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(season[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.season.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "Season" + i);
                                        for(var j = 0; j < season[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(season[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Meter Size': 
                            for(var i = 0; i < survey.meterSizes.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "MeterSize" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'MeterSizeValues" onclick = "pushParameterValues(\''+ identifier +'\')" value =\'' + survey.meterSizes[i] + '"\'/>'+
                                '' + survey.meterSizes[i] + '"</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(commodityMeterSize[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.meterSizes.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "MeterSize" + i);
                                        for(var j = 0; j < commodityMeterSize[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(commodityMeterSize[currentIndex][tierIdentifier][j] == checkCheckBox.value + "<QUOTE>")
                                            {
                                                
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Meter Type': 
                            for(var i = 0; i < survey.meterTypes.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "MeterType" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'MeterTypeValues" onclick = "pushParameterValues(\''+ identifier +'\')" value =\'' + survey.meterTypes[i] + '\'/>'+
                                '' + survey.meterTypes[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(meterType[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.meterTypes.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "MeterType" + i);
                                        for(var j = 0; j < meterType[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(meterType[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Area': 
                            for(var i = 0; i < survey.area.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "Area" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'AreaValues" onclick = "pushParameterValues(\''+ identifier +'\')" value =\'' + survey.area[i] + '\'/>'+
                                '' + survey.area[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(area[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.area.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "Area" + i);
                                        for(var j = 0; j < area[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(area[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Month': 
                            for(var i = 0; i < survey.month.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "Month" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'SeasonValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="' + survey.month[i] + '"/>'+
                                '' + survey.month[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(month[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.month.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "Month" + i);
                                        for(var j = 0; j < month[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(month[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Temperature Zone':
                            for(var i = 0; i < survey.temperatureZone.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "TemperatureZone" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'TemperatureZoneValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="' + survey.temperatureZone[i]+ '"/>'+
                                '' + survey.temperatureZone[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(temperatureZone[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.temperatureZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "TemperatureZone" + i);
                                        for(var j = 0; j < temperatureZone[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(temperatureZone[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Elevation Zone':
                            for(var i = 0; i < survey.elevationZone.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "ElevationZone" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'ElevationZoneValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="Elevation ' + survey.elevationZone[i]+ '"/>'+
                                '' + survey.elevationZone[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(elevationZone[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.elevationZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "ElevationZone" + i);
                                        for(var j = 0; j < elevationZone[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(elevationZone[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Pressure Zone':
                            for(var i = 0; i < survey.pressureZone.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "PressureZone" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'PressureZoneValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="Pressure ' + survey.pressureZone[i]+ '"/>'+
                                '' + survey.pressureZone[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(pressureZone[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.pressureZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "PressureZone" + i);
                                        for(var j = 0; j < pressureZone[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(pressureZone[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                        case 'Lot Size Group':
                            for(var i = 0; i < survey.lotSizeGroup.length; ++i)
                            {   
                                var divider = document.createElement("div");
                                divider.classList.add("checkbox");
                                var checkboxID = identifier + "LotSizeGroup" + i;
                                divider.innerHTML += '<label for = "' + checkboxID + '"><input type = "checkbox" id = "' + checkboxID + '" name = "' + identifier + 'LotSizeGroupValues" onclick = "pushParameterValues(\''+ identifier +'\')" value ="Lot Size ' + survey.lotSizeGroup[i]+ '"/>'+
                                '' + survey.lotSizeGroup[i] + '</label>';
                                DIV.appendChild(divider);
                            }
                            
                            if(lotSizeGroup[currentIndex][tierIdentifier] != null)
                            {
                                    for(var i = 0; i < survey.lotSizeGroup.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(identifier + "LotSizeGroup" + i);
                                        for(var j = 0; j < lotSizeGroup[currentIndex][tierIdentifier].length; ++j)
                                        {
                                            if(lotSizeGroup[currentIndex][tierIdentifier][j] == checkCheckBox.value)
                                            {
                                                checkCheckBox.checked = true;
                                            }
                                        }
                                    }
                            }
                            break;
                    }
                }
                
                //Clears parameters not used by cust class
                function clearParametersNotUsed(Structure, tierIdentifier)
                {
                    for(value in survey.commodityDependsOn)
                    {
                        if(jQuery.inArray(survey.commodityDependsOn[value], Structure) == -1)
                        {
                            switch(survey.commodityDependsOn[value])
                            {
                                case 'Season': season[currentIndex][tierIdentifier] = []; break;
                                case 'Meter Size': commodityMeterSize[currentIndex][tierIdentifier] = []; break;
                                case 'Month': month[currentIndex][tierIdentifier] = []; break;
                                case 'Temperature Zone': temperatureZone[currentIndex][tierIdentifier] = []; break;
                                case 'Lot Size Group': lotSizeGroup[currentIndex][tierIdentifier] = []; break;
                                case 'Pressure Zone': pressureZone[currentIndex][tierIdentifier] = []; break;
                                case 'Elevation Zone': elevationZone[currentIndex][tierIdentifier] = []; break;
                                case 'Meter Type': meterType[currentIndex][tierIdentifier] = []; break;
                                case 'Area': area[currentIndex][tierIdentifier] = []; break;
                            }
                        }
                    }
                }
                
                function pushParameterValues(Identifier)
                {
                    if(Identifier == 'Uniform')
                    {
                        theSwitchStatement(uniformParameters[currentIndex], Identifier, 0);
                        getUniformRate();
                    }
                    else if(Identifier == 'tierStarts' || Identifier == 'tierPrices')
                    {
                        if(Identifier == "tierStarts")
                        {
                            var Continue = true;
                            theSwitchStatement(tierStartsParameters[currentIndex], Identifier, 1);
                            createUsedParameters(tierStartsParameters[currentIndex], 1);
                            for(var i = 0; i < ParametersToUse.length; ++i)
                            {
                                if(ParametersToUse[i] == null)
                                {
                                    Continue = false;
                                    i = ParametersToUse.length;
                                }
                            }
                            
                            if(Continue)
                            {
                                tierStartsCategories[currentIndex] = [];
                                getCategories(tierStartsCategories[currentIndex], 0, ParametersToUse.length, "", "Level:");
                            }
                            
                            var tierStartsValuesDiv = document.getElementById("tierStartsValuesDiv");
                            
                            if(tierStartsCategories[currentIndex].length  > 0)
                            {
                                if(commodityStructure[currentIndex] == "Tiered")
                                {
                                    createTierFields(tierStartsValuesDiv, "tierStarts", tierStartsCategories[currentIndex], "Tier Levels (Must be an Integer): ");
                                }
                                else
                                {
                                    createTierFields(tierStartsValuesDiv, "tierStarts", tierStartsCategories[currentIndex], "Tier Levels (Must be in the format 100%): ");
                                }
                            }
                        }
                        else
                        {
                            var Continue = true;
                            theSwitchStatement(tierPricesParameters[currentIndex], Identifier, 2);
                            createUsedParameters(tierPricesParameters[currentIndex], 2);
                            for(var i = 0; i < ParametersToUse.length; ++i)
                            {
                                if(ParametersToUse[i] == null)
                                {
                                    Continue = false;
                                    i = ParametersToUse.length;
                                }
                            }
                            
                            if(Continue)
                            {
                                commodityChargeCategories[currentIndex] = [];
                                getCategories(commodityChargeCategories[currentIndex], 0, ParametersToUse.length, "", "Rate:");
                            }
                            
                            var tierPricesValuesDiv = document.getElementById("tierPricesValuesDiv");
                            
                            if(commodityChargeCategories[currentIndex].length > 0)
                            {
                                createTierFields(tierPricesValuesDiv, "tierPrices", commodityChargeCategories[currentIndex], "Tier Prices (Must be in the format 15.99):");
                            }
                        }
                    }
                    else if (Identifier == "service")
                    {
                        theSwitchStatement(serviceParameters[currentIndex], Identifier, 3);
                        getServiceRate();
                    }
                }
                
                function theSwitchStatement(theArray, Identifier, tierIdentifier)
                {
                    for(var j = 0; j < theArray.length; ++j)
                        {
                            switch(theArray[j])
                            {
                                case 'Season': 
                                    season[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.season.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "Season" + i);
                                        if(checkCheckBox.checked)
                                        { 
                                            season[currentIndex][tierIdentifier].push(checkCheckBox.value); 
                                        }
                                    } break;
                                case 'Meter Size': 
                                    commodityMeterSize[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.meterSizes.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "MeterSize" + i);
                                        if(checkCheckBox.checked)
                                        { 
                                            commodityMeterSize[currentIndex][tierIdentifier].push(checkCheckBox.value + "<QUOTE>"); 
                                        }
                                    } break;
                                case 'Meter Type': 
                                    meterType[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.meterTypes.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "MeterType" + i);
                                        if(checkCheckBox.checked)
                                        { 
                                            meterType[currentIndex][tierIdentifier].push(checkCheckBox.value); 
                                        }
                                    } break;
                                case 'Area': 
                                    area[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.area.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "Area" + i);
                                        if(checkCheckBox.checked)
                                        { 
                                            area[currentIndex][tierIdentifier].push(checkCheckBox.value); 
                                        }
                                    } break;
                                case 'Month': 
                                    month[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.month.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "Month" + i);
                                        if(checkCheckBox.checked)
                                        { 
                                            month[currentIndex][tierIdentifier].push(checkCheckBox.value); 
                                        }
                                    } break;
                                case 'Temperature Zone':
                                    temperatureZone[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.temperatureZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "TemperatureZone" + i);
                                        if(checkCheckBox.checked)
                                        { temperatureZone[currentIndex][tierIdentifier].push(checkCheckBox.value); }
                                    } break;
                                case 'Pressure Zone':
                                    pressureZone[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.pressureZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "PressureZone" + i);
                                        if(checkCheckBox.checked)
                                        { pressureZone[currentIndex][tierIdentifier].push(checkCheckBox.value); }
                                    } break;
                                case 'Elevation Zone':
                                    elevationZone[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.elevationZone.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "ElevationZone" + i);
                                        if(checkCheckBox.checked)
                                        { elevationZone[currentIndex][tierIdentifier].push(checkCheckBox.value); }
                                    } break;
                                case 'Lot Size Group':
                                    lotSizeGroup[currentIndex][tierIdentifier] = [];
                                    for(var i = 0; i < survey.lotSizeGroup.length; ++i)
                                    {
                                        var checkCheckBox = document.getElementById(Identifier + "LotSizeGroup" + i);
                                        if(checkCheckBox.checked)
                                        { lotSizeGroup[currentIndex][tierIdentifier].push(checkCheckBox.value); }
                                    } break;
                            }
                        }
                }
                
                function getCategories(actualArray, Position, Stop, Text, EndText)
                {
                    if(Position == Stop)
                    {
                        actualArray.push(Text + EndText);
                    }
                    else
                    {
                        for(var i = 0; i < ParametersToUse[Position].length; ++i)
                        {
                            Temp = Text;
                            Temp += ParametersToUse[Position][i] + " ";
                            getCategories(actualArray, Position + 1, Stop, Temp, EndText);
                        }
                    }
                }
                
                function createUsedParameters(parameterList, identifier)
                {
                    ParametersToUse = [];
                        
                    for(var i = 0; i < parameterList.length; ++i)
                    {
                        if(season[currentIndex] != null || commodityMeterSize[currentIndex] != null || month[currentIndex] != null || temperatureZone[currentIndex] != null || elevationZone[currentIndex] != null || pressureZone[currentIndex] != null || lotSizeGroup[currentIndex] != null )
                        {
                            switch(parameterList[i])
                            {
                                case 'Season': ParametersToUse[i] = season[currentIndex][identifier]; break;
                                case 'Meter Size': ParametersToUse[i] = commodityMeterSize[currentIndex][identifier]; break;
                                case 'Month': ParametersToUse[i] = month[currentIndex][identifier]; break;
                                case 'Temperature Zone': ParametersToUse[i] = temperatureZone[currentIndex][identifier]; break;
                                case 'Elevation Zone': ParametersToUse[i] = elevationZone[currentIndex][identifier]; break;
                                case 'Pressure Zone': ParametersToUse[i] = pressureZone[currentIndex][identifier]; break;
                                case 'Lot Size Group': ParametersToUse[i] = lotSizeGroup[currentIndex][identifier]; break;
                                case 'Meter Type': ParametersToUse[i] = meterType[currentIndex][identifier]; break;
                                case 'Area': ParametersToUse[i] = area[currentIndex][identifier]; break;
                            }
                        }
                    }
                }
                
                function createTierFields(DIV, identifier, categoryArray, subtitle)
                {
                    if(DIV.childNodes.length > 0)
                    {
                        clear(DIV);
                    }
                    
                    if(commodityCharges[currentIndex] != null && commodityCharges[currentIndex].length != 0)
                    {
                        if(commodityCharges[currentIndex].length != commodityChargeCategories[currentIndex].length*tierLevels[currentIndex])
                            commodityCharges[currentIndex] = [];
                    }
                    if(tierStartsValues[currentIndex] != null)
                    {
                        if(tierStartsValues[currentIndex].length != tierStartsCategories[currentIndex].length*tierLevels[currentIndex])
                            tierStartsValues[currentIndex] = [];
                    }
                    
                    Answer = document.createElement("h4");
                    Answer.appendChild(document.createTextNode(subtitle));
                    DIV.appendChild(Answer);
                    
                    var number = 0;
                    for(var i = 0; i < categoryArray.length; ++i)
                    {
                        var ID = categoryArray[i].split(" ").join();
                        
                        if(ID != "" && ID != "Level :" && ID != "Rate:")
                        {
                            Answer = document.createElement("h5");
                            Answer.appendChild(document.createTextNode(categoryArray[i].split("<QUOTE>").join("")));
                            DIV.appendChild(Answer);
                        }
                        
                        for(var j = 0; j < tierLevels[currentIndex]; ++j)
                        {
                            var divider = document.createElement("div");
                            divider.classList.add("form-group");
                            DIV.appendChild(divider);
                            
                            Answer = document.createElement("label");
                            Answer.setAttribute("for", identifier + number);
                            Answer.appendChild(document.createTextNode("Tier " + (j + 1) + ": "));
                            divider.appendChild(Answer);
                            
                            var itemGroup = document.createElement("div");
                            itemGroup.classList.add("input-group");
                            divider.appendChild(itemGroup);
                            
                            Answer = document.createElement("span");
                            Answer.classList.add("input-group-addon");
                            
                            if(identifier == "tierStarts")
                                Answer.innerHTML = '<i class = "glyphicon glyphicon-tint"></i>'
                            else
                                Answer.innerHTML = '<i class = "glyphicon glyphicon-usd"></i>'
                            itemGroup.appendChild(Answer);
                            
                            Answer = document.createElement("input");
                            Answer.setAttribute("type", "text");
                            Answer.classList.add("form-control");
                            Answer.id = identifier + number;
                            number++;
                            
                            if(j == 0 && identifier == "tierStarts")
                            {
                                Answer.value = 0;
                                Answer.readOnly = true;
                            }
                            
                            if(j == 1 && identifier == "tierStarts" &&  commodityStructure[currentIndex] == 'Budget')
                            {
                                Answer.value = 'indoor';
                            }
                            
                            itemGroup.appendChild(Answer);
                        }
                    }
                    
                    if(identifier == "tierStarts" && tierStartsValues[currentIndex] != null && tierStartsValues[currentIndex].length == tierStartsCategories[currentIndex].length*tierLevels[currentIndex])
                    {
                        var index = 0;
                        for(var i = 0; i < categoryArray.length; ++i)
                        {
                            for(var j = 0; j < tierLevels[currentIndex]; ++j)
                            {
                                var temp = document.getElementById(identifier + index);
                                temp.value = tierStartsValues[currentIndex][index];
                                index++;
                            }
                        }
                    }
                    else if(identifier == "tierPrices" && commodityCharges[currentIndex] != null && commodityCharges[currentIndex].length == commodityChargeCategories[currentIndex].length*tierLevels[currentIndex])
                    {
                        var index = 0;
                        for(var i = 0; i < categoryArray.length; ++i)
                        {
                            for(var j = 0; j < tierLevels[currentIndex]; ++j)
                            {
                                var temp = document.getElementById(identifier + index);
                                temp.value = commodityCharges[currentIndex][index];
                                index++;
                            }
                        }
                    }
                }
                
                function errorCheckCommodityParameters(structure, tierIdentifier, Continue)
                {
                    for(var i = 0; i < structure.length; ++i)
                    {
                        switch(structure[i])
                        {
                            case "Season":
                                if(season[currentIndex][tierIdentifier] == null || season[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Season");
                                } break;
                            case "SMeter Size":
                                if(commodityMeterSize[currentIndex][tierIdentifier] == null || commodityMeterSize[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Meter Size");
                                } break;
                            case "Month":
                                if(month[currentIndex][tierIdentifier] == null || month[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Month");
                                } break;
                            case "Temperature Zone":
                                if(temperatureZone[currentIndex][tierIdentifier] == null || temperatureZone[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Temperature Zone");
                                } break;
                            case "Elevation Zone":
                                if(elevationZone[currentIndex][tierIdentifier] == null || elevationZone[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Elevation Zone");
                                } break;
                            case "Pressure Zone":
                                if(pressureZone[currentIndex][tierIdentifier] == null || pressureZone[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                     alert("No parameters selected for Pressure Zone");
                                } break;
                            case "Lot Size Group":
                                if(lotSizeGroup[currentIndex][tierIdentifier] == null || lotSizeGroup[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Lot Size Group");
                                } break;
                            case "Lot Size Group":
                                if(meterType[currentIndex][tierIdentifier] == null || meterType[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Meter Type");
                                } break;
                            case "Area":
                                if(area[currentIndex][tierIdentifier] == null || area[currentIndex][tierIdentifier].length == 0)
                                {
                                    Continue = false;
                                    alert("No parameters selected for Area");
                                } break;
                        }
                    }
                    
                    
                    return Continue;
                }
                
                
                function PreviousGetAnswers()
                {
                    
                    if(currentIndex == 0)
                    {
                        ChargePage();
                    }
                    else
                    {   
                        currentIndex -= 1;
                        RateStructure(currentIndex);
                    }
                }
                
                function NextGetAnswers()
                {
                    var Continue = true;
                    if(isServiceCharge[currentIndex])
                    {
                        if(!isServiceSame[currentIndex])
                        {
                            if(isServiceDepends[currentIndex])
                            {
                                if(serviceParameters[currentIndex] != null)
                                {
                                    Continue = errorCheckCommodityParameters(serviceParameters[currentIndex], 3, Continue);
                                            
                                    if(Continue)
                                    {
                                        if(serviceChargeCategories[currentIndex] != null)
                                        {
                                            serviceCharges[currentIndex] = []
                                            for(var i = 0; i < serviceChargeCategories[currentIndex].length; ++i)
                                            {
                                                var tempCharge = document.getElementById("serviceCharge" + i);
                            
                                                if(tempCharge.value == "")
                                                {
                                                    alert("Service Charge at row " + (i + 1) + " isn't filled out");
                                                    Continue = false;
                                                }
                                                else
                                                {
                                                    var regex = /^\d+(?:.\d{2})$/.test(tempCharge.value);
                                                    if(regex)
                                                    {
                                                        serviceCharges[currentIndex].push(tempCharge.value);
                                                    }
                                                    else
                                                    {
                                                        alert("Service Charge at row " + (i + 1) + " must be in the Format 1.00");
                                                        Continue = false;
                                                    }
                                                }
                                            }   
                                        }  
                                        else
                                        {
                                            Continue = false;
                                            alert("Please Select a Parameter");
                                        }
                                    }
                                }
                                else
                                {
                                    Continue = false;
                                    alert('You must select a parameter for the Service Charge or select "No" the Service Charge does not depend on anything');
                                }
                            }
                            else
                            {
                                var temp = document.getElementById("ServiceCharge");
                                if(temp.value == "")
                                {
                                    alert("The Service Charge Field is Empty");
                                    Continue = false;
                                }
                                else
                                {
                                    var regex = /^\d+(?:.\d{2})$/.test(temp.value);
                                    if(regex)
                                    {
                                        serviceCharges[currentIndex] = []
                                        serviceCharges[currentIndex].push(temp.value);
                                    }
                                    else
                                    {
                                        alert("The service charge must be in the Format 1.00");
                                        Continue = false;
                                    }
                                }
                            }
                        }
                        else
                        {
                            if(isServiceCharge[serviceSameStructure[currentIndex]] == false)
                            {
                                Continue = false;
                                alert("The Service Charge for the Structure you Selected does not contain a service charge select another.")
                            }
                        }
                    }
                        
                    if(isCommodityCharge[currentIndex])
                    {
                        if(commodityStructure[currentIndex] == null)
                        {
                            Continue = false;
                            alert('A commodity structure must be selected');
                        }
                        else
                        {
                            switch(commodityStructure[currentIndex])
                            {
                                case 'Uniform': 
                                commodityCharges[currentIndex] = []
                                if(isUniformDependsOn[currentIndex] == "No")
                                {
                                    var Charge = document.getElementById("commodityCharge0");
                                    if(Charge.value == "")
                                    { alert("You must enter a rate"); Continue = false; } 
                                    else
                                    { 
                                        var regex = /^\d+(?:.\d{2})$/.test(Charge.value);
                                        if(regex)
                                        {
                                            commodityCharges[currentIndex].push(Charge.value);
                                        }
                                        else
                                        {
                                            alert('Rate must be in the Format 1.00');
                                            Continue = false;
                                        }
                                    }
                                }
                                else
                                {
                                    if(uniformParameters[currentIndex] != null)
                                    {
                                        Continue = errorCheckCommodityParameters(uniformParameters[currentIndex], 0, Continue);
                                        
                                        if(Continue)
                                        {
                                            if(commodityChargeCategories[currentIndex] != null)
                                            {
                                                for(var i = 0; i < commodityChargeCategories[currentIndex].length; ++i)
                                                {
                                                    var tempCharge = document.getElementById("commodityCharge" + i);
                                    
                                                    if(tempCharge.value == "")
                                                    {
                                                        alert("Commodity Charge at row " + (i + 1) + " isn't filled out");
                                                        Continue = false;
                                                    }
                                                    else
                                                    {
                                                        var regex = /^\d+(?:.\d{2})$/.test(tempCharge.value);
                                                        if(regex)
                                                        {
                                                            commodityCharges[currentIndex].push(tempCharge.value);
                                                        }
                                                        else
                                                        {
                                                            alert("Commodity Charge at row " + (i + 1) + " must be in the Format 1.00");
                                                            Continue = false;
                                                        }
                                                    }
                                                }   
                                            }  
                                            else
                                            {
                                                Continue = false;
                                                alert("Please Select a Parameter");
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Continue = false;
                                        alert('You must select a parameter for the flat rate or select "No" the rate does not depend on anything');
                                    }
                                }
                                break;
                                case 'Tiered': 
                                commodityCharges[currentIndex] = [];
                                tierStartsValues[currentIndex] = [];
                                
                                if(isTierStartsDepends[currentIndex])
                                {
                                    if(tierStartsParameters[currentIndex] != null && tierStartsParameters[currentIndex].length > 0)
                                    {
                                        Continue = errorCheckCommodityParameters(tierStartsParameters[currentIndex], 1, Continue);
                                        
                                        if(Continue)
                                        {
                                            if(tierStartsCategories[currentIndex] != null && tierStartsCategories[currentIndex].length > 0)
                                            {
                                                for(var i = 0; i < (tierStartsCategories[currentIndex].length*tierLevels[currentIndex]); ++i)
                                                {
                                                    var tempCharge = document.getElementById("tierStarts" + i);
                                    
                                                    if(tempCharge.value == "")
                                                    {
                                                        var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                        alert("The Tier Level for " + tierStartsCategories[currentIndex][tempIndex].replace(" Level:", "").replace("<QUOTE>", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " isn't filled out");
                                                        Continue = false;
                                                    }
                                                    else
                                                    {
                                                        var regex = /^\d+$/.test(tempCharge.value);
                                                        if(regex)
                                                        {
                                                            tierStartsValues[currentIndex].push(tempCharge.value);
                                                        }
                                                        else
                                                        {
                                                            var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                            alert("The Tier Level for " + tierStartsCategories[currentIndex][tempIndex].replace(" Level:", "").replace("<QUOTE>", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " must be an integer");
                                                            Continue = false;
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                Continue = false;
                                                alert("Parameter Fields are empty");
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Continue = false;
                                        alert("No parameters Selected for Tier Levels");
                                    }
                                }
                                else
                                {
                                    for(var i = 0; i < tierLevels[currentIndex]; ++i)
                                    {
                                        var Level = document.getElementById("tierStarts" + i);
                                        if(Level.value == "")
                                        { 
                                            alert("You must enter a CCF level for tier " + (i + 1)); 
                                            Continue = false;
                                        } 
                                        else
                                        { 
                                            var regex = /^\d+$/.test(Level.value);
                                            if(regex)
                                            {
                                                tierStartsValues[currentIndex].push(Level.value);
                                            }
                                            else
                                            {
                                                alert("The Tier Level for tier " + (i % tierLevels[currentIndex] + 1) + " must be an integer");
                                                Continue = false;
                                            } 
                                        }
                                    }
                                }
                                
                                if(isTierPricesDepends[currentIndex])
                                {
                                    if(tierPricesParameters[currentIndex] != null && tierPricesParameters[currentIndex].length > 0)
                                    {
                                        Continue = errorCheckCommodityParameters(tierPricesParameters[currentIndex], 2, Continue);
                                        
                                        if(Continue)
                                        {
                                            if(commodityChargeCategories[currentIndex] != null && commodityChargeCategories[currentIndex].length > 0)
                                            { 
                                                for(var i = 0; i < (commodityChargeCategories[currentIndex].length*tierLevels[currentIndex]); ++i)
                                                {
                                                    var tempCharge = document.getElementById("tierPrices" + i);
                                    
                                                    if(tempCharge.value == "")
                                                    {
                                                        var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                        alert("The Tier Price for " + commodityChargeCategories[currentIndex][tempIndex].replace(" Rate:", "").replace("<QUOTE>", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " isn't filled out");
                                                        Continue = false;
                                                    }
                                                    else
                                                    {
                                                        var regex = /^\d+(?:.\d{2})$/.test(tempCharge.value);
                                                        if(regex)
                                                        {
                                                            commodityCharges[currentIndex].push(tempCharge.value);
                                                        }
                                                        else
                                                        {
                                                            var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                            alert("The Tier Price for " + commodityChargeCategories[currentIndex][tempIndex].replace(" Rate:", "").replace("<QUOTE>", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " must be in the Format 1.00");
                                                            Continue = false;
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                Continue = false;
                                                alert("Parameter Fields are empty");
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Continue = false;
                                        alert("No parameters Selected for Tier Prices");
                                    }
                                }
                                else
                                {
                                    for(var i = 0; i < tierLevels[currentIndex]; ++i)
                                    {
                                        var Price = document.getElementById("tierPrices" + i);
                                        if(Price.value == "")
                                        { 
                                            alert("You must enter a Price for tier " + (i + 1)); 
                                            Continue = false;
                                        } 
                                        else
                                        { 
                                            var regex = /^\d+(?:.\d{2})$/.test(Price.value);
                                            if(regex)
                                            {
                                                commodityCharges[currentIndex].push(Price.value);
                                            }
                                            else
                                            {
                                                alert("The Tier Price for tier " + (i % tierLevels[currentIndex] + 1) + " must be in the Format 1.00");
                                                Continue = false;
                                            } 
                                        }
                                    }
                                }
                                
                                break;
                                case 'Budget':
                                gpcd[currentIndex] = null;
                                indoor[currentIndex] = null;
                                outdoor[currentIndex] = null;
                                landscape_factor[currentIndex] = null;
                                budget[currentIndex] = null;
                                commodityCharges[currentIndex] = [];
                                tierStartsValues[currentIndex] = [];
                                
                                gpcdValue = document.getElementById("gpcd");
                                if(gpcdValue.value != "")
                                {
                                    try
                                    {
                                        gpcd[currentIndex] = Number(gpcdValue.value);
                                    }
                                    catch (err)
                                    {
                                        alert("Gallons Per Capita Daily must be a number");
                                        Continue = false;
                                    }
                                }
                                else
                                {
                                    alert("Gallons Per Capita Day field empty");
                                    Continue = false;
                                }
                                
                                indoorValue = document.getElementById("indoor");
                                if(indoorValue.value != "")
                                    indoor[currentIndex] = indoorValue.value;
                                else
                                {
                                    alert("Indoor Equation field empty");
                                    Continue = false;
                                }
                                
                                outdoorValue = document.getElementById("outdoor");
                                if(indoorValue.value != "")
                                    outdoor[currentIndex] = outdoorValue.value;
                                else
                                {
                                    alert("Outdoor Equation field empty");
                                    Continue = false;
                                }
                                
                                landscape_factorValue = document.getElementById("landscape_factor");
                                if(landscape_factorValue.value != "")
                                    landscape_factor[currentIndex] = landscape_factorValue.value;
                                else
                                {
                                    alert("Landscape Factor field empty");
                                    Continue = false;
                                }
                                
                                budgetValue = document.getElementById("budget");
                                if(budgetValue.value != "")
                                    budget[currentIndex] = budgetValue.value;
                                else
                                {
                                    alert("Outdoor Equation field empty");
                                    Continue = false;
                                }
                                
                                if(isTierStartsDepends[currentIndex])
                                {
                                    if(tierStartsParameters[currentIndex] != null && tierStartsParameters[currentIndex].length > 0)
                                    {
                                        Continue = errorCheckCommodityParameters(tierStartsParameters[currentIndex], 1, Continue);
                                        
                                        if(Continue)
                                        {
                                            if(tierStartsCategories[currentIndex] != null && tierStartsCategories[currentIndex].length > 0)
                                            {
                                                for(var i = 0; i < (tierStartsCategories[currentIndex].length*tierLevels[currentIndex]); ++i)
                                                {
                                                    var tempCharge = document.getElementById("tierStarts" + i);
                                    
                                                    if(tempCharge.value == "")
                                                    {
                                                        var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                        alert("The Tier Level for " + tierStartsCategories[currentIndex][tempIndex].replace(" Level:", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " isn't filled out");
                                                        Continue = false;
                                                    }
                                                    else
                                                    {
                                                        var regex = /^\d+(?:%)$/.test(tempCharge.value);
                                                        if(i % tierLevels[currentIndex] + 1 == 2)
                                                        {
                                                            if(tempCharge.value == "indoor" || regex)
                                                            {
                                                                tierStartsValues[currentIndex].push(tempCharge.value);
                                                            }
                                                            else
                                                            {
                                                                var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                                alert("The Tier Level for " + tierStartsCategories[currentIndex][tempIndex].replace(" Level:", "").replace("<QUOTE>", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " must be in the format 100% or say indoor");
                                                                Continue = false;
                                                            }
                                                        }
                                                        else if(i % tierLevels[currentIndex] + 1 > 2)
                                                        {
                                                            if(regex)
                                                            {
                                                                tierStartsValues[currentIndex].push(tempCharge.value);
                                                            }
                                                            else
                                                            {
                                                                var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                                alert("The Tier Level for " + tierStartsCategories[currentIndex][tempIndex].replace(" Level:", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " must be in the format 100% or 1%");
                                                                Continue = false;
                                                            }
                                                        }
                                                        else
                                                        {
                                                            tierStartsValues[currentIndex].push(tempCharge.value);
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                Continue = false;
                                                alert("Parameter Fields are empty");
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Continue = false;
                                        alert("No parameters Selected for Tier Levels");
                                    }
                                }
                                else
                                {
                                    for(var i = 0; i < tierLevels[currentIndex]; ++i)
                                    {
                                        var Level = document.getElementById("tierStarts" + i);
                                        if(Level.value == "")
                                        { 
                                            alert("You must enter a CCF level for tier " + (i + 1)); 
                                            Continue = false;
                                        } 
                                        else
                                        { 
                                            var regex = /^\d+(?:%)$/.test(Level.value);
                                            if(i > 1)
                                            {
                                                if(regex)
                                                {
                                                    tierStartsValues[currentIndex].push(Level.value);
                                                }
                                                else
                                                {
                                                    alert("The Tier Level for tier " + (i + 1) + " must be in the format 100% or 1%");
                                                    Continue = false;
                                                }
                                            }
                                            else
                                            {
                                                if(i == 1)
                                                {
                                                    if(Level.value == "indoor" || regex)
                                                        tierStartsValues[currentIndex].push(Level.value);
                                                    else
                                                        alert("The Tier Level for tier " + (i + 1) + " must be in the format 100% or say indoor");
                                                }
                                                else
                                                    tierStartsValues[currentIndex].push(Level.value); 
                                            }
                                        }
                                    }
                                }
                                
                                if(isTierPricesDepends[currentIndex])
                                {
                                    if(tierPricesParameters[currentIndex] != null && tierPricesParameters[currentIndex].length > 0)
                                    {
                                        Continue = errorCheckCommodityParameters(tierPricesParameters[currentIndex], 2, Continue);
                                        
                                        if(Continue)
                                        {
                                            if(commodityChargeCategories[currentIndex] != null && commodityChargeCategories[currentIndex].length > 0)
                                            { 
                                                for(var i = 0; i < (commodityChargeCategories[currentIndex].length*tierLevels[currentIndex]); ++i)
                                                {
                                                    var tempCharge = document.getElementById("tierPrices" + i);
                                    
                                                    if(tempCharge.value == "")
                                                    {
                                                        var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                        alert("The Tier Price for " + commodityChargeCategories[currentIndex][tempIndex].replace(" Rate:", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " isn't filled out");
                                                        Continue = false;
                                                    }
                                                    else
                                                    {
                                                        var regex = /^\d+(?:.\d{2})$/.test(tempCharge.value);
                                                        if(regex)
                                                        {
                                                            commodityCharges[currentIndex].push(tempCharge.value);
                                                        }
                                                        else
                                                        {
                                                            var tempIndex = Math.floor(i/tierLevels[currentIndex]);
                                                            alert("The Tier Price for " + commodityChargeCategories[currentIndex][tempIndex].replace(" Rate:", "") + " at tier " + (i % tierLevels[currentIndex] + 1) + " must be in the Format 1.00");
                                                            Continue = false;
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                Continue = false;
                                                alert("Parameter Fields are empty");
                                            }
                                        }
                                    }
                                    else
                                    {
                                        Continue = false;
                                        alert("No parameters Selected for Tier Prices");
                                    }
                                }
                                else
                                {
                                    for(var i = 0; i < tierLevels[currentIndex]; ++i)
                                    {
                                        var Price = document.getElementById("tierPrices" + i);
                                        if(Price.value == "")
                                        { 
                                            alert("You must enter a Price for tier " + (i + 1)); 
                                            Continue = false;
                                        } 
                                        else
                                        { 
                                            var regex = /^\d+(?:.\d{2})$/.test(Price.value);
                                            if(regex)
                                            {
                                                commodityCharges[currentIndex].push(Price.value);
                                            }
                                            else
                                            {
                                                alert("The Tier Price for tier " + (i % tierLevels[currentIndex] + 1) + " must be in the Format 1.00");
                                                Continue = false;
                                            } 
                                        }
                                    }
                                }                                
                                break;
                            }
                        }
                    }
                    
                    if(Continue)
                    {
                        if(currentIndex == SelectedRateStructures.length - 1)
                        {
                            Complete();
                        }
                        else
                        {
                            currentIndex += 1;
                            RateStructure(currentIndex);
                        }
                    }
                }
                
                function parameterParser(structure)
                {
                    switch(structure)
                    {
                        case 'Season': return 'season'; break;
                        case 'Temperature Zone': return 'temperature_zone'; break;
                        case 'Elevation Zone': return 'elevation_zone'; break;
                        case 'Pressure Zone': return 'pressure_zone'; break;
                        case 'Lot Size Group': return 'lot_size_group'; break;
                        case 'Meter Size': return 'meter_size'; break;
                        case 'Month': return 'month'; break;
                        case 'Meter Type': return 'meter_type'; break;
                        case 'Area': return 'area'; break;
                    }
                }
                
                function Complete()
                {
                    OWRSformat = {
                       "metadata" : {
                            "effective_date" : "" + EffectiveDate + "",
                            "utility_name" : "" + UtilityName + "",
                            "bill_frequency" : "" + BillFrequency + ""
                       }, 
                       "capacity_charge" : {
                           
                       },
                       "rate_structure" : {
                       
                       }
                    };
                    
                    if(isCapacityCharge)
                    {
                        OWRSformat.capacity_charge = {
                            "depends_on" : ["meter_size"]
                        }
                        
                        var valueStorage = '{';
                        for(var i = 0; i < capacityCharges.length; ++i)
                        {
                            console.log(capacityMeterSizes[i]);
                            if(i == capacityCharges.length - 1)
                            {
                                valueStorage += '"' + capacityMeterSizes[i] + '" : ' + capacityCharges[i] + ' }'
                            }
                            else
                            {
                                valueStorage += '"' + capacityMeterSizes[i] + '" : ' + capacityCharges[i] + ', '
                            }
                        }
                        OWRSformat.capacity_charge.values = JSON.parse(valueStorage);
                    }
                    
                    for(var structure in SelectedRateStructures)
                    {
                        var tempStructure; 
                        
                        var serviceJSON;
                        var commodityJSON;
                        
                        if(isServiceCharge[structure])
                        {
                            if(!isServiceDepends[structure])
                            {
                                serviceJSON = Number(serviceCharges[currentIndex][0]);
                            }
                            else
                            {
                                serviceJSON = {
                                    "depends_on" : [],
                                    "values" : {}
                                };
                            
                                for(var i = 0; i < serviceParameters[structure].length; ++i)
                                {
                                    var temp = parameterParser(serviceParameters[structure][i]);
                                    serviceJSON.depends_on.push(temp);
                                }
                            
                                var valueStorage = '{';
                                for(var value in serviceCharges[structure])
                                {
                                    var replacementStr = stringFormatter(serviceChargeCategories[structure][value]);
                                    if(value == serviceCharges[structure].length - 1)
                                    {
                                        valueStorage += '"' + replacementStr.split(" ").join("|") + '" : ' + serviceCharges[structure][value] + ' }'
                                    }
                                    else
                                    {
                                        valueStorage += '"' + replacementStr.split(" ").join("|") + '" : ' + serviceCharges[structure][value] + ', '
                                    }
                                }
                                serviceJSON.values = JSON.parse(valueStorage);
                            }
                        }
                        else
                        { serviceJSON = 0; }
                    
                        if(isCommodityCharge[structure])
                        {
                            commodityJSON = "";
                            switch(commodityStructure[structure])
                            {
                                case 'Uniform':
                                    commodityJSON  = {
                                        "commodity_charge": "flat_rate*usage_ccf",
                                        "flat_rate" : {}
                                    };
                                    
                                    if(isUniformDependsOn[structure] == 'No')
                                    {
                                        commodityJSON.flat_rate = Number(commodityCharges[structure][0]);
                                    }
                                    else
                                    {
                                        commodityJSON.flat_rate.depends_on = [];
                                        
                                        for(var i = 0; i < uniformParameters[structure].length; ++i)
                                        {
                                            var temp = parameterParser(uniformParameters[structure][i]);
                                            commodityJSON.flat_rate.depends_on.push(temp);
                                        }
                                        
                                        var tempComm = "{ "
                                        for(value in commodityChargeCategories[structure])
                                        {
                                            var replacementStr = stringFormatter(commodityChargeCategories[structure][value]);
                                            
                                            if(value == commodityChargeCategories[structure].length - 1)
                                            {
                                                tempComm += '"' + replacementStr.split(" ").join("|") + '": ' + commodityCharges[structure][value]+ ' }';
                                            }
                                            else
                                            {
                                                tempComm += '"' + replacementStr.split(" ").join("|") + '": ' + commodityCharges[structure][value]+ ', ';
                                            }
                                        }
                                        commodityJSON.flat_rate.values = JSON.parse(tempComm);
                                    } break;
                                case 'Tiered':
                                    commodityJSON = { "commodity_charge": "Tiered" };
                                    if(isTierStartsDepends[structure])
                                    {
                                        commodityJSON.tier_starts = { "depends_on": [],
                                                                      "values": {}     };
                                        for(var i = 0; i < tierStartsParameters[structure].length; ++i)
                                        {
                                            var temp = parameterParser(tierStartsParameters[structure][i])
                                            commodityJSON.tier_starts.depends_on.push(temp);
                                        }
                                        
                                        var tempComm = "{ ", number = 0; 
                                        for(value in tierStartsCategories[structure])
                                        {
                                            var replacementStr = stringFormatter(commodityChargeCategories[structure][value]);
                                            tempComm += ' "' + replacementStr.split(" ").join("|") + '": [ ';
                                            
                                            for(var k = 0; k < tierLevels[structure]; ++k)
                                            {
                                                if(k == tierLevels[structure] - 1)
                                                {
                                                    tempComm += tierStartsValues[structure][number] + ' ]';
                                                }
                                                else
                                                {
                                                    tempComm += tierStartsValues[structure][number] + ', ';
                                                }
                                                number++;
                                            }
                                            
                                            if(value == tierStartsCategories[structure].length - 1)
                                                tempComm += ' }';
                                            else
                                                tempComm += ', '
                                        }
                                        commodityJSON.tier_starts.values = JSON.parse(tempComm)
                                    }
                                    else
                                    {
                                        commodityJSON.tier_starts = [];
                                        for(var i = 0; i < tierLevels[structure]; ++i)
                                        {
                                            commodityJSON.tier_starts.push(Number(tierStartsValues[structure][i]));
                                        }
                                    }
                                    if(isTierPricesDepends[structure])
                                    {
                                        commodityJSON.tier_prices = { "depends_on": [],
                                                                      "values": {}     };
                                        for(var i = 0; i < tierPricesParameters[structure].length; ++i)
                                        {
                                            var temp = parameterParser(tierPricesParameters[structure][i])
                                            commodityJSON.tier_prices.depends_on.push(temp);
                                        }
                                        
                                        var tempComm = "{ ", number = 0; 
                                        for(value in commodityChargeCategories[structure])
                                        {
                                            var replacementStr = stringFormatter(commodityChargeCategories[structure][value]);
                                            tempComm += ' "' + replacementStr.split(" ").join("|") + '": [ ';
                                            
                                            for(var k = 0; k < tierLevels[structure]; ++k)
                                            {
                                                if(k == tierLevels[structure] - 1)
                                                {
                                                    tempComm += commodityCharges[structure][number] + ' ]';
                                                }
                                                else
                                                {
                                                    tempComm += commodityCharges[structure][number] + ', ';
                                                }
                                                number++;
                                            }
                                            
                                            if(value == commodityChargeCategories[structure].length - 1)
                                                tempComm += ' }';
                                            else
                                                tempComm += ', '
                                        }
                                        commodityJSON.tier_prices.values = JSON.parse(tempComm)
                                    }
                                    else
                                    {
                                        commodityJSON.tier_prices = [];
                                        for(var i = 0; i < tierLevels[structure]; ++i)
                                        {
                                            commodityJSON.tier_prices.push(Number(commodityCharges[structure][i]));
                                        }
                                    } break;
                                case 'Budget':
                                commodityJSON = { "commodity_charge": "Budget" };
                                    
                                    commodityJSON.gpcd = gpcd[structure];
                                    commodityJSON.indoor = indoor[structure];
                                    commodityJSON.outdoor = outdoor[structure];
                                    commodityJSON.budget = budget[structure];
                                    commodityJSON.landscape_factor = landscape_factor[structure];
                                    
                                    if(isTierStartsDepends[structure])
                                    {
                                        commodityJSON.tier_starts = { "depends_on": [],
                                                                      "values": {}     };
                                        for(var i = 0; i < tierStartsParameters[structure].length; ++i)
                                        {
                                            var temp = parameterParser(tierStartsParameters[structure][i])
                                            commodityJSON.tier_starts.depends_on.push(temp);
                                        }
                                        
                                        var tempComm = "{ ", number = 0; 
                                        for(value in tierStartsCategories[structure])
                                        {
                                            var replacementStr = stringFormatter(tierStartsCategories[structure][value]);
                                            tempComm += ' "' + replacementStr.split(" ").join("|") + '": [ ';
                                            
                                            for(var k = 0; k < tierLevels[structure]; ++k)
                                            {
                                                if(k == tierLevels[structure] - 1)
                                                {
                                                    tempComm += '"' + tierStartsValues[structure][number] + '" ]';
                                                }
                                                else
                                                {
                                                    tempComm += '"' + tierStartsValues[structure][number] + '", ';
                                                }
                                                number++;
                                            }
                                            
                                            if(value == tierStartsCategories[structure].length - 1)
                                                tempComm += ' }';
                                            else
                                                tempComm += ', '
                                        }
                                        commodityJSON.tier_starts.values = JSON.parse(tempComm)
                                    }
                                    else
                                    {
                                        commodityJSON.tier_starts = [];
                                        for(var i = 0; i < tierLevels[structure]; ++i)
                                        {
                                            commodityJSON.tier_starts.push(tierStartsValues[structure][i]);
                                        }
                                    }
                                    if(isTierPricesDepends[structure])
                                    {
                                        commodityJSON.tier_prices = { "depends_on": [],
                                                                      "values": {}     };
                                        for(var i = 0; i < tierPricesParameters[structure].length; ++i)
                                        {
                                            var temp = parameterParser(tierPricesParameters[structure][i])
                                            commodityJSON.tier_prices.depends_on.push(temp);
                                        }
                                        
                                        var tempComm = "{ ", number = 0; 
                                        for(value in commodityChargeCategories[structure])
                                        {
                                            var replacementStr = stringFormatter(commodityChargeCategories[structure][value]);
                                            tempComm += ' "' + replacementStr.split(" ").join("|") + '": [ ';
                                            
                                            for(var k = 0; k < tierLevels[structure]; ++k)
                                            {
                                                if(k == tierLevels[structure] - 1)
                                                {
                                                    tempComm += commodityCharges[structure][number] + ' ]';
                                                }
                                                else
                                                {
                                                    tempComm += commodityCharges[structure][number] + ', ';
                                                }
                                                number++;
                                            }
                                            
                                            if(value == commodityChargeCategories[structure].length - 1)
                                                tempComm += ' }';
                                            else
                                                tempComm += ', '
                                        }
                                        commodityJSON.tier_prices.values = JSON.parse(tempComm)
                                    }
                                    else
                                    {
                                        commodityJSON.tier_prices = [];
                                        for(var i = 0; i < tierLevels[structure]; ++i)
                                        {
                                            commodityJSON.tier_prices.push(Number(commodityCharges[structure][i]));
                                        }
                                    } break;
                            }
                        }
                        else
                        { commodityJSON = { "commodity_charge" : 0 } };
                        
                        switch(SelectedRateStructures[structure])
                        {
                            case "Residential Single": tempStructure = { "RESIDENTIAL_SINGLE" : { "service_charge" : {} } };
                                                        tempStructure.RESIDENTIAL_SINGLE.service_charge = serviceJSON ;
                                                        tempStructure.RESIDENTIAL_SINGLE = jQuery.extend({}, tempStructure.RESIDENTIAL_SINGLE, commodityJSON); 
                                                        tempStructure.RESIDENTIAL_SINGLE.bill = "service_charge+commodity_charge"; break;
                            case "Residential Multi": tempStructure = { "RESIDENTIAL_MULTI" : { "service_charge" : {} } }; 
                                                        tempStructure.RESIDENTIAL_MULTI.service_charge = serviceJSON; 
                                                        tempStructure.RESIDENTIAL_MULTI = jQuery.extend({}, tempStructure.RESIDENTIAL_MULTI, commodityJSON); 
                                                        tempStructure.RESIDENTIAL_MULTI.bill = "service_charge+commodity_charge"; break;
                            case "Irrigation": tempStructure = { "IRRIGATION" : { "service_charge" : {} } };
                                                        tempStructure.IRRIGATION.service_charge = serviceJSON; 
                                                        tempStructure.IRRIGATION = jQuery.extend({}, tempStructure.IRRIGATION, commodityJSON); 
                                                        tempStructure.IRRIGATION.bill = "service_charge+commodity_charge"; break;
                            case "Commercial": tempStructure = { "COMMERCIAL" : { "service_charge" : {} } }; 
                                                        tempStructure.COMMERCIAL.service_charge = serviceJSON; 
                                                        tempStructure.COMMERCIAL = jQuery.extend({}, tempStructure.COMMERCIAL, commodityJSON); 
                                                        tempStructure.COMMERCIAL.bill = "service_charge+commodity_charge"; break;
                            case "Industrial": tempStructure = { "INDUSTRIAL" : { "service_charge" : {} } };
                                                        tempStructure.INDUSTRIAL.service_charge = serviceJSON; 
                                                        tempStructure.INDUSTRIAL = jQuery.extend({}, tempStructure.INDUSTRIAL, commodityJSON); 
                                                        tempStructure.INDUSTRIAL.bill = "service_charge+commodity_charge"; break;
                            case "Institutional": tempStructure = { "INSTITUTIONAL" : { "service_charge" : {} } };
                                                        tempStructure.INSTITUTIONAL.service_charge = serviceJSON; 
                                                        tempStructure.INSTITUTIONAL = jQuery.extend({}, tempStructure.INSTITUTIONAL, commodityJSON); 
                                                        tempStructure.INSTITUTIONAL.bill = "service_charge+commodity_charge"; break;
                            case "Fire Service": tempStructure = { "FIRE_SERVICE" : { "service_charge" : {} } }; 
                                                        tempStructure.FIRE_SERVICE.service_charge = serviceJSON; 
                                                        tempStructure.FIRE_SERVICE = jQuery.extend({}, tempStructure.FIRE_SERVICE, commodityJSON); 
                                                        tempStructure.FIRE_SERVICE.bill = "service_charge+commodity_charge"; break;
                            case "Non-Potable": tempStructure = { "NONPOTABLE" : { "service_charge" : {} } };
                                                        tempStructure.NONPOTABLE.service_charge = serviceJSON; 
                                                        tempStructure.NONPOTABLE = jQuery.extend({}, tempStructure.NONPOTABLE, commodityJSON); 
                                                        tempStructure.NONPOTABLE.bill = "service_charge+commodity_charge"; break;
                            case "Potable": tempStructure = { "POTABLE" : { "service_charge" : {} } };
                                                        tempStructure.POTABLE.service_charge = serviceJSON; 
                                                        tempStructure.POTABLE = jQuery.extend({}, tempStructure.POTABLE, commodityJSON); 
                                                        tempStructure.POTABLE.bill = "service_charge+commodity_charge"; break;
                            case "Recycled": tempStructure = { "RECYCLED" : { "service_charge" : {} } };
                                                        tempStructure.RECYCLED.service_charge = serviceJSON; 
                                                        tempStructure.RECYCLED = jQuery.extend({}, tempStructure.RECYCLED, commodityJSON); 
                                                        tempStructure.RECYCLED.bill = "service_charge+commodity_charge"; break;                            
                            case "Non-Residential": tempStructure = { "NON_RESIDENTIAL" : { "service_charge" : {} } }; 
                                                        tempStructure.NON_RESIDENTIAL.service_charge = serviceJSON; 
                                                        tempStructure.NON_RESIDENTIAL = jQuery.extend({}, tempStructure.NON_RESIDENTIAL, commodityJSON); 
                                                        tempStructure.NON_RESIDENTIAL.bill = "service_charge+commodity_charge"; break;
                            case "Unmetered": tempStructure = { "UNMETERED" : { "service_charge" : {} } };
                                                        tempStructure.UNMETERED.service_charge = serviceJSON; 
                                                        tempStructure.UNMETERED = jQuery.extend({}, tempStructure.UNMETERED, commodityJSON); 
                                                        tempStructure.UNMETERED.bill = "service_charge+commodity_charge"; break;
                            case "Reclaimed": tempStructure = { "RECLAIMED" : { "service_charge" : {} } }; 
                                                        tempStructure.RECLAIMED.service_charge = serviceJSON; 
                                                        tempStructure.RECLAIMED = jQuery.extend({}, tempStructure.RECLAIMED, commodityJSON); 
                                                        tempStructure.RECLAIMED.bill = "service_charge+commodity_charge"; break;
                            case "Governmental": tempStructure = { "GOVERNMENTAL" : { "service_charge" : {} } }; 
                                                        tempStructure.GOVERNMENTAL.service_charge = serviceJSON; 
                                                        tempStructure.GOVERNMENTAL = jQuery.extend({}, tempStructure.GOVERNMENTAL, commodityJSON); 
                                                        tempStructure.GOVERNMENTAL.bill = "service_charge+commodity_charge"; break;
                            case "Interruptible": tempStructure = { "INTERRUPTIBLE" : { "service_charge" : {} } }; 
                                                        tempStructure.INTERRUPTIBLE.service_charge = serviceJSON; 
                                                        tempStructure.INTERRUPTIBLE = jQuery.extend({}, tempStructure.INTERRUPTIBLE, commodityJSON); 
                                                        tempStructure.INTERRUPTIBLE.bill = "service_charge+commodity_charge"; break;
                            case "Docks Shipping": tempStructure = { "DOCKS_SHIPPING" : { "service_charge" : {} } }; 
                                                        tempStructure.DOCKS_SHIPPING.service_charge = serviceJSON; 
                                                        tempStructure.DOCKS_SHIPPING = jQuery.extend({}, tempStructure.DOCKS_SHIPPING, commodityJSON); 
                                                        tempStructure.DOCKS_SHIPPING.bill = "service_charge+commodity_charge"; break;
                            case "Building Contractor": tempStructure = { "BUILDING_CONTRACTOR" : { "service_charge" : {} } }; 
                                                        tempStructure.BUILDING_CONTRACTOR.service_charge = serviceJSON; 
                                                        tempStructure.BUILDING_CONTRACTOR = jQuery.extend({}, tempStructure.BUILDING_CONTRACTOR, commodityJSON); 
                                                        tempStructure.BUILDING_CONTRACTOR.bill = "service_charge+commodity_charge"; break;
                            case "Residential Construction": tempStructure = { "RESIDENTIAL_CONSTRUCTION" : { "service_charge" : {} } }; 
                                                        tempStructure.RESIDENTIAL_CONSTRUCTION.service_charge = serviceJSON; 
                                                        tempStructure.RESIDENTIAL_CONSTRUCTION = jQuery.extend({}, tempStructure.RESIDENTIAL_CONSTRUCTION, commodityJSON);
                                                        tempStructure.RESIDENTIAL_CONSTRUCTION.bill = "service_charge+commodity_charge"; break;
                            case "Other": tempStructure = { "OTHER" : { "service_charge" : {} } }; 
                                                        tempStructure.OTHER.service_charge = serviceJSON; 
                                                        tempStructure.OTHER = jQuery.extend({}, tempStructure.OTHER, commodityJSON); 
                                                        tempStructure.OTHER.bill = "service_charge+commodity_charge"; break;
                        }
                        OWRSformat.rate_structure = jQuery.extend({}, OWRSformat.rate_structure, tempStructure);
                    }
                    
                    var YAML = jsyaml.safeDump(OWRSformat);
                    YAML = YAML.split('<QUOTE>').join('"');
                    YAML = YAML.split("'").join("");
                    
                    var cleared = document.getElementById("panel");
                    
                    
                    clear(cleared);
                    
                    var YAMLfile = document.createElement("pre");
                    YAMLfile.innerHTML = YAML;
                    cleared.appendChild(YAMLfile);
                    
                    /*
                    var submitForm = document.createElement("form");
                    submitForm.id = "survey";
                    submitForm.method = "POST";
                    submitForm.action = "/"
                    cleared.appendChild(submitForm);
                    
                    var TheEnd = document.createElement("input");
                    TheEnd.setAttribute("type", "hidden");
                    TheEnd.name = "YAML";
                    TheEnd.value = YAML;
                    submitForm.appendChild(TheEnd);
                    
                    var TheEnd = document.createElement("input");
                    TheEnd.setAttribute("type", "hidden");
                    TheEnd.name = "Utility";
                    TheEnd.value = UtilityName;
                    submitForm.appendChild(TheEnd);
                    
                    var TheEnd = document.createElement("input");
                    TheEnd.setAttribute("type", "hidden");
                    TheEnd.name = "Date";
                    TheEnd.value = EffectiveDate;
                    submitForm.appendChild(TheEnd);
                    
                    submitForm.submit();
                    */
                    
                }
                
                function stringFormatter(theString)
                {
                    var replacementStr = theString.replace(" Rate:", ""); replacementStr = theString.replace(" Level:", "");
                    replacementStr = replacementStr.replace("Pressure ", ""); replacementStr = replacementStr.replace("Elevation ", "");
                    replacementStr = replacementStr.replace("Lot Size ", ""); replacementStr = replacementStr.replace('"', '');
                    replacementStr = replacementStr.replace("Inside City", "inside_city"); replacementStr = replacementStr.replace("Outside City", "outside_city");
                    replacementStr = replacementStr.replace("Omni F2", "Omni_F2");
                    
                    for(var i = 0; i < survey.month.length; ++i)
                    {
                        replacementStr = replacementStr.replace(survey.month[i], i + 1);
                    }
                    
                    return replacementStr;
                }
                
                function QuestionTxt(question, number, Parent)
                {
                    Question = document.createElement("h5");
                    Question.appendChild(document.createTextNode(question));
                    Question.setAttribute("id", "question" + number);
                    Parent.appendChild(Question);
                }
                
                function clear(parent)
                {
                    while(parent.firstChild)
                    {  parent.removeChild(parent.firstChild); }
                }
                
                MainPage();